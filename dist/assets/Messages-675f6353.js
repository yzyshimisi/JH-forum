import{d as j,c as O,r as K,e as n,f as a,k as s,w as o,bf as p,j as v,y as h,A as l,x as c,q as $,Y as i,l as P,u as D,F as L,H as w,b as Q}from"./@vue-a481fc63.js";import{u as W}from"./vuex-44de225f.js";import{u as T,b as U}from"./vue-router-e5a2430e.js";import{K as E,L as G,M as H,_ as A,N as J}from"./index-2ed44994.js";import{a as Y}from"./formatTime-4210fcd1.js";import{J as B,K as X,N as Z,O as V,Q as x}from"./@vicons-1a3558c6.js";import{o as ee,M as se,j as ne,l as te,S as ae,L as oe,U as re,F as ie,Q as le,I as _e,G as ue}from"./naive-ui-d8de3dda.js";import{_ as pe}from"./main-nav.vue_vue_type_style_index_0_lang-db3a5418.js";import"./axios-4a70c6fc.js";/* empty css               */import"./seemly-76b7b838.js";import"./vueuc-39372edb.js";import"./evtd-b614532e.js";import"./@css-render-7124a1a5.js";import"./vooks-6d99783e.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-6a5c5852.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-8412e618.js";import"./treemate-25c27bff.js";import"./async-validator-dee29e8b.js";import"./date-fns-975a2d8f.js";import"./moment-2ab8298d.js";const me={class:"sender-wrap"},de={key:0,class:"nickname"},ce={class:"username"},ge={key:1,class:"nickname"},ve={class:"username"},ye={key:2,class:"nickname"},fe={class:"timestamp"},ke={class:"timestamp-txt"},he={key:0,class:"brief-content"},we={key:1,class:"whisper-content-wrap"},$e={key:2,class:"requesting-friend-wrap"},Ce={key:2,class:"status-info"},be={key:3,class:"status-info"},Ie="https://assets.paopao.info/public/avatar/default/admin.png",Me=j({__name:"message-item",props:{message:{}},setup(z){const _=z,C=T(),r=W(),m=O(()=>_.message.type!=4||!_.message.sender_user_id==r.state.userInfo.id),y=O(()=>_.message.type==4&&_.message.receiver_user_id==r.state.userInfo.id),g=O(()=>_.message.type==4&&_.message.sender_user_id==r.state.userInfo.id),f=e=>{u(e),(e.type===1||e.type===2||e.type===3)&&(e.post&&e.post.id>0?C.push({name:"post",query:{id:e.post_id}}):window.$message.error("该动态已被删除"))},b=e=>{u(e),E({user_id:e.sender_user_id}).then(t=>{e.reply_id=2,window.$message.success("已同意添加好友")}).catch(t=>{console.log(t)})},N=e=>{u(e),G({user_id:e.sender_user_id}).then(t=>{e.reply_id=3,window.$message.success("已拒绝添加好友")}).catch(t=>{console.log(t)})},u=e=>{_.message.receiver_user_id==r.state.userInfo.id&&e.is_read===0&&H({id:e.id}).then(t=>{e.is_read=1}).catch(t=>{console.log(t)})};return(e,t)=>{const S=ee,I=K("router-link"),k=se,d=ne,F=te,q=ae,M=oe;return n(),a("div",{class:P(["message-item",{unread:m.value&&e.message.is_read===0}]),onClick:t[5]||(t[5]=R=>u(e.message))},[s(M,{"content-indented":""},{avatar:o(()=>[s(S,{round:"",size:30,src:e.message.type==4&&e.message.sender_user_id==p(r).state.userInfo.id?e.message.receiver_user.avatar:e.message.sender_user.id>0?e.message.sender_user.avatar:Ie},null,8,["src"])]),header:o(()=>[v("div",me,[e.message.type!=4&&e.message.sender_user.id>0||y.value?(n(),a("span",de,[s(I,{onClick:t[0]||(t[0]=h(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{s:e.message.sender_user.username}}},{default:o(()=>[l(c(e.message.sender_user.nickname),1)]),_:1},8,["to"]),v("span",ce," @"+c(e.message.sender_user.username),1)])):g.value?(n(),a("span",ge,[s(I,{onClick:t[1]||(t[1]=h(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{s:e.message.receiver_user.username}}},{default:o(()=>[l(c(e.message.receiver_user.nickname),1)]),_:1},8,["to"]),v("span",ve," @"+c(e.message.receiver_user.username),1)])):(n(),a("span",ye," 系统 ")),e.message.type==4?(n(),$(k,{key:3,class:"top-tag",type:"success",size:"small",round:""},{default:o(()=>[l(" 私信 ")]),_:1})):i("",!0),g.value?(n(),$(k,{key:4,class:"top-tag",type:"info",size:"small",round:""},{icon:o(()=>[s(d,{component:p(B)},null,8,["component"])]),default:o(()=>[l(" 已发送 ")]),_:1})):i("",!0),e.message.type==4&&e.message.receiver_user_id==p(r).state.userInfo.id?(n(),$(k,{key:5,class:"top-tag",type:"warning",size:"small",round:""},{icon:o(()=>[s(d,{component:p(B)},null,8,["component"])]),default:o(()=>[l(" 已接收 ")]),_:1})):i("",!0)])]),"header-extra":o(()=>[v("span",fe,[m.value&&e.message.is_read===0?(n(),$(F,{key:0,dot:"",processing:""})):i("",!0),v("span",ke,c(p(Y)(e.message.created_on)),1)])]),description:o(()=>[s(q,{"show-icon":!1,class:"brief-wrap",type:!m.value||e.message.is_read>0?"default":"success"},{default:o(()=>[e.message.type!=4?(n(),a("div",he,[l(c(e.message.brief)+" ",1),e.message.type===1||e.message.type===2||e.message.type===3?(n(),a("span",{key:0,onClick:t[2]||(t[2]=h(R=>f(e.message),["stop"])),class:"hash-link view-link"},[s(d,null,{default:o(()=>[s(p(X))]),_:1}),l(" 查看详情 ")])):i("",!0)])):i("",!0),e.message.type===4?(n(),a("div",we,c(e.message.content),1)):i("",!0),e.message.type===5?(n(),a("div",$e,[l(c(e.message.content)+" ",1),e.message.reply_id===1?(n(),a("span",{key:0,onClick:t[3]||(t[3]=h(R=>b(e.message),["stop"])),class:"hash-link view-link"},[s(d,null,{default:o(()=>[s(p(Z))]),_:1}),l(" 同意 ")])):i("",!0),e.message.reply_id===1?(n(),a("span",{key:1,onClick:t[4]||(t[4]=h(R=>N(e.message),["stop"])),class:"hash-link view-link"},[s(d,null,{default:o(()=>[s(p(V))]),_:1}),l(" 拒绝 ")])):i("",!0),e.message.reply_id===2?(n(),a("span",Ce,[s(d,null,{default:o(()=>[s(p(x))]),_:1}),l(" 已同意 ")])):i("",!0),e.message.reply_id===3?(n(),a("span",be,[s(d,null,{default:o(()=>[s(p(V))]),_:1}),l(" 已拒绝 ")])):i("",!0)])):i("",!0)]),_:1},8,["type"])]),_:1})],2)}}});const ze=A(Me,[["__scopeId","data-v-debc3954"]]),Ne={class:"content"},Se=j({__name:"message-skeleton",props:{num:{default:1}},setup(z){return(_,C)=>{const r=re;return n(!0),a(L,null,D(new Array(_.num),m=>(n(),a("div",{class:"skeleton-item",key:m},[v("div",Ne,[s(r,{text:"",repeat:2}),s(r,{text:"",style:{width:"60%"}})])]))),128)}}});const Fe=A(Se,[["__scopeId","data-v-01d2e871"]]),qe={key:0,class:"skeleton-wrap"},Re={key:1},Oe={key:0,class:"empty-wrap"},je={key:0,class:"pagination-wrap"},Ae=j({__name:"Messages",setup(z){const _=U(),C=W(),r=w(!1),m=w(+_.query.p||1),y=w(10),g=w(0),f=w([]),b=()=>{r.value=!0,J({page:m.value,page_size:y.value}).then(u=>{r.value=!1,f.value=u.list,g.value=Math.ceil(u.pager.total_rows/y.value)}).catch(u=>{r.value=!1})},N=u=>{m.value=u,b()};return Q(()=>{b()}),(u,e)=>{const t=pe,S=Fe,I=_e,k=ze,d=ue,F=ie,q=le;return n(),a("div",null,[s(t,{title:"消息"}),s(F,{class:"main-content-wrap messages-wrap",bordered:""},{default:o(()=>[r.value?(n(),a("div",qe,[s(S,{num:y.value},null,8,["num"])])):(n(),a("div",Re,[f.value.length===0?(n(),a("div",Oe,[s(I,{size:"large",description:"暂无数据"})])):i("",!0),(n(!0),a(L,null,D(f.value,M=>(n(),$(d,{key:M.id},{default:o(()=>[s(k,{message:M},null,8,["message"])]),_:2},1024))),128))]))]),_:1}),g.value>0?(n(),a("div",je,[s(q,{page:m.value,"onUpdate:page":N,"page-slot":p(C).state.collapsedRight?5:8,"page-count":g.value},null,8,["page","page-slot","page-count"])])):i("",!0)])}}});const rs=A(Ae,[["__scopeId","data-v-4e7b1342"]]);export{rs as default};
