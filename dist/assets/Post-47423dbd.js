import{d as $e,_ as Y,e as xe,f as Ce,g as Ie,h as Pe,i as Re,j as ze,k as Se,l as Ue,s as Te,v as Ae,p as Le,m as qe,n as Me,o as Oe}from"./index-1063388e.js";import{_ as Be,c as Z,H as je,N as ne,I as de,m as ue,J as me,s as De,t as Ne,v as Ve,w as Ee,x as Fe,z as He,K as Ke,L as Je,g as Ge,M as Qe,i as ve,D as Ye,G as Ze,h as We,F as Xe,d as et,e as tt}from"./naive-ui-9980ffcb.js";import{d as J,r as p,o as a,c as d,a as _,O as k,L as s,Y as n,e as b,_ as re,M as P,K as U,U as e,n as ee,a3 as st,F as te,$ as se,Z as H,j as _e,a4 as fe,a5 as ge,w as ot}from"./@vue-f70ab1bd.js";import{u as ae}from"./vuex-cc1858c6.js";import{f as oe}from"./formatTime-936c40eb.js";import{T as he,I as nt,e as at,f as lt,g as it,h as ct,i as ut,j as rt,k as _t}from"./@vicons-fc06a0bb.js";import{p as pe,_ as ye,a as pt,b as dt,c as mt}from"./content-83d95999.js";import{u as ke,b as vt}from"./vue-router-29025daf.js";import{_ as ft}from"./post-skeleton-cd4157b0.js";import{l as gt}from"./lodash-3329902d.js";import{V as Q}from"./IEnum-ea67d3af.js";import{a as ht}from"./copy-to-clipboard-ca358197.js";import{_ as yt}from"./main-nav.vue_vue_type_style_index_0_lang-455f4f57.js";import"./axios-707ed124.js";/* empty css               */import"./seemly-76b7b838.js";import"./vueuc-804c4158.js";import"./evtd-b614532e.js";import"./@css-render-66126308.js";import"./vooks-dfdd6eef.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-6a5c5852.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-8412e618.js";import"./treemate-25c27bff.js";import"./async-validator-dee29e8b.js";import"./date-fns-975a2d8f.js";import"./moment-b7869f98.js";import"./nonesir-video-29a967e9.js";import"./toggle-selection-93f4ad84.js";const kt={class:"reply-compose-wrap"},wt={class:"reply-switch"},bt={key:0,class:"reply-input-wrap"},$t=J({__name:"compose-reply",props:{commentId:{default:0},atUserid:{default:0},atUsername:{default:""}},emits:["reload","reset"],setup(z,{expose:T,emit:i}){const c=z,R=p(),w=p(!1),v=p(""),I=p(!1),l=f=>{w.value=f,f?setTimeout(()=>{var r;(r=R.value)==null||r.focus()},10):(I.value=!1,v.value="",i("reset"))},S=()=>{I.value=!0,$e({comment_id:c.commentId,at_user_id:c.atUserid,content:v.value}).then(f=>{l(!1),window.$message.success("评论成功"),i("reload")}).catch(f=>{I.value=!1})};return T({switchReply:l}),(f,r)=>{const $=Be,o=Z,x=je;return a(),d("div",kt,[_("div",wt,[w.value?k("",!0):(a(),d("span",{key:0,class:"show",onClick:r[0]||(r[0]=h=>l(!0))}," 回复 ")),w.value?(a(),d("span",{key:1,class:"hide",onClick:r[1]||(r[1]=h=>l(!1))}," 取消 ")):k("",!0)]),w.value?(a(),d("div",bt,[s(x,null,{default:n(()=>[s($,{ref_key:"inputInstRef",ref:R,size:"small",placeholder:c.atUsername?"@"+c.atUsername:"请输入回复内容..",maxlength:"100",value:v.value,"onUpdate:value":r[2]||(r[2]=h=>v.value=h),"show-count":"",clearable:""},null,8,["placeholder","value"]),s(o,{type:"primary",size:"small",ghost:"",loading:I.value,onClick:S},{default:n(()=>[b(" 回复 ")]),_:1},8,["loading"])]),_:1})])):k("",!0)])}}});const xt=Y($t,[["__scopeId","data-v-89bc7a6d"]]),Ct={class:"reply-item"},It={class:"header-wrap"},Pt={class:"username"},Rt={class:"reply-name"},zt={class:"timestamp"},St={class:"base-wrap"},Ut={class:"content"},Tt={key:0,class:"reply-switch"},At=J({__name:"reply-item",props:{reply:null},emits:["focusReply","reload"],setup(z,{emit:T}){const i=z,c=ae(),R=()=>{T("focusReply",i.reply)},w=()=>{xe({id:i.reply.id}).then(v=>{window.$message.success("删除成功"),setTimeout(()=>{T("reload")},50)}).catch(v=>{console.log(v)})};return(v,I)=>{const l=re("router-link"),S=ne,f=Z,r=de;return a(),d("div",Ct,[_("div",It,[_("div",Pt,[s(l,{class:"user-link",to:{name:"user",query:{username:i.reply.user.username}}},{default:n(()=>[b(P(i.reply.user.username),1)]),_:1},8,["to"]),_("span",Rt,P(i.reply.at_user_id>0?"回复":":"),1),i.reply.at_user_id>0?(a(),U(l,{key:0,class:"user-link",to:{name:"user",query:{username:i.reply.at_user.username}}},{default:n(()=>[b(P(i.reply.at_user.username),1)]),_:1},8,["to"])):k("",!0)]),_("div",zt,[b(P(i.reply.ip_loc?i.reply.ip_loc+" · ":i.reply.ip_loc)+" "+P(e(oe)(i.reply.created_on,e(c).state.collapsedLeft))+" ",1),e(c).state.userInfo.is_admin||e(c).state.userInfo.id===i.reply.user.id?(a(),U(r,{key:0,"negative-text":"取消","positive-text":"确认",onPositiveClick:w},{trigger:n(()=>[s(f,{quaternary:"",circle:"",size:"tiny",class:"del-btn"},{icon:n(()=>[s(S,null,{default:n(()=>[s(e(he))]),_:1})]),_:1})]),default:n(()=>[b(" 是否确认删除？ ")]),_:1})):k("",!0)])]),_("div",St,[_("div",Ut,P(i.reply.content),1),e(c).state.userInfo.id>0?(a(),d("div",Tt,[_("span",{class:"show",onClick:R}," 回复 ")])):k("",!0)])])}}});const Lt=Y(At,[["__scopeId","data-v-c486479f"]]),qt={class:"comment-item"},Mt={class:"nickname-wrap"},Ot={class:"username-wrap"},Bt={class:"opt-wrap"},jt={class:"timestamp"},Dt=["innerHTML"],Nt={class:"reply-wrap"},Vt=J({__name:"comment-item",props:{comment:null},emits:["reload"],setup(z,{emit:T}){const i=z,c=ae(),R=ke(),w=p(0),v=p(""),I=p(),l=ee(()=>{let x=Object.assign({texts:[],imgs:[]},i.comment);return x.contents.map(h=>{(+h.type==1||+h.type==2)&&x.texts.push(h),+h.type==3&&x.imgs.push(h)}),x}),S=(x,h)=>{let A=x.target;if(A.dataset.detail){const L=A.dataset.detail.split(":");L.length===2&&(c.commit("refresh"),L[0]==="tag"?window.$message.warning("评论内的无效话题"):R.push({name:"user",query:{username:L[1]}}))}},f=x=>{var h,A;w.value=x.user_id,v.value=((h=x.user)==null?void 0:h.username)||"",(A=I.value)==null||A.switchReply(!0)},r=()=>{T("reload")},$=()=>{w.value=0,v.value=""},o=()=>{Ce({id:l.value.id}).then(x=>{window.$message.success("删除成功"),setTimeout(()=>{r()},50)}).catch(x=>{})};return(x,h)=>{const A=ue,L=re("router-link"),B=ne,j=Z,D=de,N=ye,V=Lt,E=xt,F=me;return a(),d("div",qt,[s(F,{"content-indented":""},st({avatar:n(()=>[s(A,{round:"",size:30,src:e(l).user.avatar},null,8,["src"])]),header:n(()=>[_("span",Mt,[s(L,{onClick:h[0]||(h[0]=H(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{username:e(l).user.username}}},{default:n(()=>[b(P(e(l).user.nickname),1)]),_:1},8,["to"])]),_("span",Ot," @"+P(e(l).user.username),1)]),"header-extra":n(()=>[_("div",Bt,[_("span",jt,P(e(l).ip_loc?e(l).ip_loc+" · ":e(l).ip_loc)+" "+P(e(oe)(e(l).created_on,e(c).state.collapsedLeft)),1),e(c).state.userInfo.is_admin||e(c).state.userInfo.id===e(l).user.id?(a(),U(D,{key:0,"negative-text":"取消","positive-text":"确认",onPositiveClick:o},{trigger:n(()=>[s(j,{quaternary:"",circle:"",size:"tiny",class:"del-btn"},{icon:n(()=>[s(B,null,{default:n(()=>[s(e(he))]),_:1})]),_:1})]),default:n(()=>[b(" 是否确认删除？ ")]),_:1})):k("",!0)])]),footer:n(()=>[e(l).imgs.length>0?(a(),U(N,{key:0,imgs:e(l).imgs},null,8,["imgs"])):k("",!0),_("div",Nt,[(a(!0),d(te,null,se(e(l).replies,t=>(a(),U(V,{key:t.id,reply:t,onFocusReply:f,onReload:r},null,8,["reply"]))),128))]),e(c).state.userInfo.id>0?(a(),U(E,{key:1,ref_key:"replyComposeRef",ref:I,"comment-id":e(l).id,"at-userid":w.value,"at-username":v.value,onReload:r,onReset:$},null,8,["comment-id","at-userid","at-username"])):k("",!0)]),_:2},[e(l).texts.length>0?{name:"description",fn:n(()=>[(a(!0),d(te,null,se(e(l).texts,t=>(a(),d("span",{key:t.id,class:"comment-text",onClick:h[1]||(h[1]=H(u=>S(u,e(l).id),["stop"])),innerHTML:e(pe)(t.content).content},null,8,Dt))),128))]),key:"0"}:void 0]),1024)])}}});const Et=Y(Vt,[["__scopeId","data-v-02db83b3"]]),Ft=z=>(fe("data-v-20c23f95"),z=z(),ge(),z),Ht={key:0,class:"compose-wrap"},Kt={class:"compose-line"},Jt={class:"compose-user"},Gt={class:"compose-line compose-options"},Qt={class:"attachment"},Yt={class:"submit-wrap"},Zt={class:"attachment-list-wrap"},Wt={key:1,class:"compose-wrap"},Xt=Ft(()=>_("div",{class:"login-wrap"},[_("span",{class:"login-banner"}," 登录后，精彩更多")],-1)),es={class:"login-wrap"},ts=J({__name:"compose-comment",props:{lock:{default:0},postId:{default:0}},emits:["post-success"],setup(z,{emit:T}){const i=z,c=ae(),R=p([]),w=p(!1),v=p(!1),I=p(!1),l=p(""),S=p(),f=p("public/image"),r=p([]),$=p([]),o="/v1/attachment",x=p(),h=gt.debounce(m=>{Ie({k:m}).then(g=>{let y=[];g.suggest.map(C=>{y.push({label:C,value:C})}),R.value=y,v.value=!1}).catch(g=>{v.value=!1})},200),A=(m,g)=>{v.value||(v.value=!0,g==="@"&&h(m))},L=m=>{m.length>200||(l.value=m)},B=m=>{f.value=m},j=m=>{r.value=m},D=async m=>{var g,y;return f.value==="public/image"&&!["image/png","image/jpg","image/jpeg","image/gif"].includes((g=m.file.file)==null?void 0:g.type)?(window.$message.warning("图片仅允许 png/jpg/gif 格式"),!1):f.value==="image"&&((y=m.file.file)==null?void 0:y.size)>10485760?(window.$message.warning("图片大小不能超过10MB"),!1):!0},N=({file:m,event:g})=>{var y;try{let C=JSON.parse((y=g.target)==null?void 0:y.response);C.code===0&&f.value==="public/image"&&$.value.push({id:m.id,content:C.data.content})}catch{window.$message.error("上传失败")}},V=({file:m,event:g})=>{var y;try{let C=JSON.parse((y=g.target)==null?void 0:y.response);if(C.code!==0){let K=C.msg||"上传失败";C.details&&C.details.length>0&&C.details.map(q=>{K+=":"+q}),window.$message.error(K)}}catch{window.$message.error("上传失败")}},E=({file:m})=>{let g=$.value.findIndex(y=>y.id===m.id);g>-1&&$.value.splice(g,1)},F=()=>{w.value=!0},t=()=>{var m;w.value=!1,(m=S.value)==null||m.clear(),r.value=[],l.value="",$.value=[]},u=()=>{if(l.value.trim().length===0){window.$message.warning("请输入内容哦");return}let{users:m}=pe(l.value);const g=[];let y=100;g.push({content:l.value,type:2,sort:y}),$.value.map(C=>{y++,g.push({content:C.content,type:3,sort:y})}),I.value=!0,Pe({contents:g,post_id:i.postId,users:Array.from(new Set(m))}).then(C=>{window.$message.success("发布成功"),I.value=!1,T("post-success"),t()}).catch(C=>{I.value=!1})},O=m=>{c.commit("triggerAuth",!0),c.commit("triggerAuthKey",m)};return _e(()=>{x.value="Bearer "+localStorage.getItem("PAOPAO_TOKEN")}),(m,g)=>{const y=ue,C=De,K=ne,q=Z,W=Ne,le=Ve,ie=Ee,ce=Fe,X=He;return a(),d("div",null,[e(c).state.userInfo.id>0?(a(),d("div",Ht,[_("div",Kt,[_("div",Jt,[s(y,{round:"",size:30,src:e(c).state.userInfo.avatar},null,8,["src"])]),s(C,{type:"textarea",size:"large",autosize:"",bordered:!1,options:R.value,prefix:["@"],loading:v.value,value:l.value,disabled:i.lock===1,"onUpdate:value":L,onSearch:A,onFocus:F,placeholder:i.lock===1?"泡泡已被锁定，回复功能已关闭":"快来评论两句吧..."},null,8,["options","loading","value","disabled","placeholder"])]),w.value?(a(),U(X,{key:0,ref_key:"uploadRef",ref:S,abstract:"","list-type":"image",multiple:!0,max:9,action:o,headers:{Authorization:x.value},data:{type:f.value},onBeforeUpload:D,onFinish:N,onError:V,onRemove:E,"onUpdate:fileList":j},{default:n(()=>[_("div",Gt,[_("div",Qt,[s(W,{abstract:""},{default:n(({handleClick:G})=>[s(q,{disabled:r.value.length>0&&f.value==="public/video"||r.value.length===9,onClick:()=>{B("public/image"),G()},quaternary:"",circle:"",type:"primary"},{icon:n(()=>[s(K,{size:"20",color:"var(--primary-color)"},{default:n(()=>[s(e(nt))]),_:1})]),_:2},1032,["disabled","onClick"])]),_:1}),s(ie,{trigger:"hover",placement:"bottom"},{trigger:n(()=>[s(le,{class:"text-statistic",type:"circle","show-indicator":!1,status:"success","stroke-width":10,percentage:l.value.length/200*100},null,8,["percentage"])]),default:n(()=>[b(" "+P(l.value.length)+" / 200 ",1)]),_:1})]),_("div",Yt,[s(q,{quaternary:"",round:"",type:"tertiary",class:"cancel-btn",size:"small",onClick:t},{default:n(()=>[b(" 取消 ")]),_:1}),s(q,{loading:I.value,onClick:u,type:"primary",secondary:"",size:"small",round:""},{default:n(()=>[b(" 发布 ")]),_:1},8,["loading"])])]),_("div",Zt,[s(ce)])]),_:1},8,["headers","data"])):k("",!0)])):(a(),d("div",Wt,[Xt,_("div",es,[s(q,{strong:"",secondary:"",round:"",type:"primary",onClick:g[0]||(g[0]=G=>O("signin"))},{default:n(()=>[b(" 登录 ")]),_:1}),s(q,{strong:"",secondary:"",round:"",type:"info",onClick:g[1]||(g[1]=G=>O("signup"))},{default:n(()=>[b(" 注册 ")]),_:1})])]))])}}});const ss=Y(ts,[["__scopeId","data-v-20c23f95"]]),os={class:"username-wrap"},ns={key:0,class:"options"},as={key:0},ls=["innerHTML"],is={class:"timestamp"},cs={key:0},us={key:1},rs={class:"opts-wrap"},_s=["onClick"],ps={class:"opt-item"},ds=["onClick"],ms=["onClick"],vs=J({__name:"post-detail",props:{post:null},emits:["reload"],setup(z,{emit:T}){const i=z,c=ae(),R=ke(),w=p(!1),v=p(!1),I=p(!1),l=p(!1),S=p(!1),f=p(!1),r=p(!1),$=p(Q.PUBLIC),o=ee({get:()=>{let t=Object.assign({texts:[],imgs:[],videos:[],links:[],attachments:[],charge_attachments:[]},i.post);return t.contents.map(u=>{(+u.type==1||+u.type==2)&&t.texts.push(u),+u.type==3&&t.imgs.push(u),+u.type==4&&t.videos.push(u),+u.type==6&&t.links.push(u),+u.type==7&&t.attachments.push(u),+u.type==8&&t.charge_attachments.push(u)}),t},set:t=>{i.post.upvote_count=t.upvote_count,i.post.comment_count=t.comment_count,i.post.collection_count=t.collection_count}}),x=ee(()=>{let t=[{label:"删除",key:"delete"}];return o.value.is_lock===0?t.push({label:"锁定",key:"lock"}):t.push({label:"解锁",key:"unlock"}),c.state.userInfo.is_admin&&(o.value.is_top===0?t.push({label:"置顶",key:"stick"}):t.push({label:"取消置顶",key:"unstick"})),o.value.visibility===Q.PUBLIC?t.push({label:"公开",key:"vpublic",children:[{label:"私密",key:"vprivate"},{label:"好友可见",key:"vfriend"}]}):o.value.visibility===Q.PRIVATE?t.push({label:"私密",key:"vprivate",children:[{label:"公开",key:"vpublic"},{label:"好友可见",key:"vfriend"}]}):t.push({label:"好友可见",key:"vfriend",children:[{label:"公开",key:"vpublic"},{label:"私密",key:"vprivate"}]}),t}),h=t=>{R.push({name:"post",query:{id:t}})},A=(t,u)=>{if(t.target.dataset.detail){const O=t.target.dataset.detail.split(":");if(O.length===2){c.commit("refresh"),O[0]==="tag"?R.push({name:"home",query:{q:O[1],t:"tag"}}):R.push({name:"user",query:{username:O[1]}});return}}h(u)},L=t=>{switch(t){case"delete":I.value=!0;break;case"lock":case"unlock":l.value=!0;break;case"stick":case"unstick":S.value=!0;break;case"vpublic":$.value=0,f.value=!0;break;case"vprivate":$.value=1,f.value=!0;break;case"vfriend":$.value=2,f.value=!0;break}},B=()=>{Se({id:o.value.id}).then(t=>{window.$message.success("删除成功"),R.replace("/"),setTimeout(()=>{c.commit("refresh")},50)}).catch(t=>{r.value=!1})},j=()=>{Ue({id:o.value.id}).then(t=>{T("reload"),t.lock_status===1?window.$message.success("锁定成功"):window.$message.success("解锁成功")}).catch(t=>{r.value=!1})},D=()=>{Te({id:o.value.id}).then(t=>{T("reload"),t.top_status===1?window.$message.success("置顶成功"):window.$message.success("取消置顶成功")}).catch(t=>{r.value=!1})},N=()=>{Ae({id:o.value.id,visibility:$.value}).then(t=>{T("reload"),window.$message.success("修改可见性成功")}).catch(t=>{r.value=!1})},V=()=>{Le({id:o.value.id}).then(t=>{w.value=t.status,t.status?o.value={...o.value,upvote_count:o.value.upvote_count+1}:o.value={...o.value,upvote_count:o.value.upvote_count-1}}).catch(t=>{console.log(t)})},E=()=>{qe({id:o.value.id}).then(t=>{v.value=t.status,t.status?o.value={...o.value,collection_count:o.value.collection_count+1}:o.value={...o.value,collection_count:o.value.collection_count-1}}).catch(t=>{console.log(t)})},F=()=>{ht(`${window.location.origin}/#/post?id=${o.value.id}`),window.$message.success("链接已复制到剪贴板")};return _e(()=>{c.state.userInfo.id>0&&(Re({id:o.value.id}).then(t=>{w.value=t.status}).catch(t=>{console.log(t)}),ze({id:o.value.id}).then(t=>{v.value=t.status}).catch(t=>{console.log(t)}))}),(t,u)=>{const O=ue,m=re("router-link"),g=Ke,y=ne,C=Z,K=Je,q=Ge,W=pt,le=ye,ie=dt,ce=mt,X=Qe,G=ve,we=me;return a(),d("div",{class:"detail-item",onClick:u[6]||(u[6]=M=>h(e(o).id))},[s(we,null,{avatar:n(()=>[s(O,{round:"",size:30,src:e(o).user.avatar},null,8,["src"])]),header:n(()=>[s(m,{onClick:u[0]||(u[0]=H(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{username:e(o).user.username}}},{default:n(()=>[b(P(e(o).user.nickname),1)]),_:1},8,["to"]),_("span",os," @"+P(e(o).user.username),1),e(o).is_top?(a(),U(g,{key:0,class:"top-tag",type:"warning",size:"small",round:""},{default:n(()=>[b(" 置顶 ")]),_:1})):k("",!0),e(o).visibility==e(Q).PRIVATE?(a(),U(g,{key:1,class:"top-tag",type:"error",size:"small",round:""},{default:n(()=>[b(" 私密 ")]),_:1})):k("",!0),e(o).visibility==e(Q).FRIEND?(a(),U(g,{key:2,class:"top-tag",type:"info",size:"small",round:""},{default:n(()=>[b(" 好友可见 ")]),_:1})):k("",!0)]),"header-extra":n(()=>[e(c).state.userInfo.is_admin||e(c).state.userInfo.id===e(o).user.id?(a(),d("div",ns,[s(K,{placement:"bottom-end",trigger:"click",size:"small",options:e(x),onSelect:L},{default:n(()=>[s(C,{quaternary:"",circle:""},{icon:n(()=>[s(y,null,{default:n(()=>[s(e(at))]),_:1})]),_:1})]),_:1},8,["options"])])):k("",!0),s(q,{show:I.value,"onUpdate:show":u[1]||(u[1]=M=>I.value=M),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定删除该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:B},null,8,["show"]),s(q,{show:l.value,"onUpdate:show":u[2]||(u[2]=M=>l.value=M),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定"+(e(o).is_lock?"解锁":"锁定")+"该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:j},null,8,["show","content"]),s(q,{show:S.value,"onUpdate:show":u[3]||(u[3]=M=>S.value=M),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定"+(e(o).is_top?"取消置顶":"置顶")+"该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:D},null,8,["show","content"]),s(q,{show:f.value,"onUpdate:show":u[4]||(u[4]=M=>f.value=M),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定将该泡泡动态可见度修改为"+($.value==0?"公开":$.value==1?"私密":"好友可见")+"吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:N},null,8,["show","content"])]),footer:n(()=>[s(W,{attachments:e(o).attachments},null,8,["attachments"]),s(W,{attachments:e(o).charge_attachments,price:e(o).attachment_price},null,8,["attachments","price"]),s(le,{imgs:e(o).imgs},null,8,["imgs"]),s(ie,{videos:e(o).videos,full:!0},null,8,["videos"]),s(ce,{links:e(o).links},null,8,["links"]),_("div",is,[b(" 发布于 "+P(e(oe)(e(o).created_on,e(c).state.collapsedLeft))+" ",1),e(o).ip_loc?(a(),d("span",cs,[s(X,{vertical:""}),b(" "+P(e(o).ip_loc),1)])):k("",!0),!e(c).state.collapsedLeft&&e(o).created_on!=e(o).latest_replied_on?(a(),d("span",us,[s(X,{vertical:""}),b(" 最后回复 "+P(e(oe)(e(o).latest_replied_on,e(c).state.collapsedLeft)),1)])):k("",!0)])]),action:n(()=>[_("div",rs,[s(G,{justify:"space-between"},{default:n(()=>[_("div",{class:"opt-item hover",onClick:H(V,["stop"])},[s(y,{size:"20",class:"opt-item-icon"},{default:n(()=>[w.value?k("",!0):(a(),U(e(lt),{key:0})),w.value?(a(),U(e(it),{key:1,color:"red"})):k("",!0)]),_:1}),b(" "+P(e(o).upvote_count),1)],8,_s),_("div",ps,[s(y,{size:"20",class:"opt-item-icon"},{default:n(()=>[s(e(ct))]),_:1}),b(" "+P(e(o).comment_count),1)]),_("div",{class:"opt-item hover",onClick:H(E,["stop"])},[s(y,{size:"20",class:"opt-item-icon"},{default:n(()=>[v.value?k("",!0):(a(),U(e(ut),{key:0})),v.value?(a(),U(e(rt),{key:1,color:"#ff7600"})):k("",!0)]),_:1}),b(" "+P(e(o).collection_count),1)],8,ds),_("div",{class:"opt-item hover",onClick:H(F,["stop"])},[s(y,{size:"20",class:"opt-item-icon"},{default:n(()=>[s(e(_t))]),_:1}),b(" "+P(e(o).share_count),1)],8,ms)]),_:1})])]),default:n(()=>[e(o).texts.length>0?(a(),d("div",as,[(a(!0),d(te,null,se(e(o).texts,M=>(a(),d("span",{key:M.id,class:"post-text",onClick:u[5]||(u[5]=H(be=>A(be,e(o).id),["stop"])),innerHTML:e(pe)(M.content).content},null,8,ls))),128))])):k("",!0)]),_:1})])}}});const fs=z=>(fe("data-v-c8247a20"),z=z(),ge(),z),gs={key:0,class:"detail-wrap"},hs={key:1,class:"empty-wrap"},ys={key:0,class:"comment-opts-wrap"},ks=fs(()=>_("div",{class:"comment-title-item"},[_("span",{"comment-title-item":""},"评论")],-1)),ws={class:"comment-opt-item"},bs={key:2},$s={key:0,class:"skeleton-wrap"},xs={key:1},Cs={key:0,class:"empty-wrap"},Is=J({__name:"Post",setup(z){const T=vt(),i=p({}),c=p(!1),R=p(!1),w=p([]),v=ee(()=>+T.query.id),I=p("default"),l=r=>{I.value=r,f()},S=()=>{i.value={id:0},c.value=!0,Me({id:v.value}).then(r=>{c.value=!1,i.value=r,f()}).catch(r=>{c.value=!1})},f=(r=!1)=>{w.value.length===0&&(R.value=!0),Oe({id:i.value.id,sort_strategy:I.value}).then($=>{w.value=$.list,R.value=!1,r&&setTimeout(()=>{window.scrollTo(0,99999)},50)}).catch($=>{R.value=!1})};return _e(()=>{S()}),ot(v,()=>{v.value>0&&T.name==="post"&&S()}),(r,$)=>{const o=yt,x=vs,h=Ze,A=We,L=Xe,B=et,j=tt,D=ve,N=ss,V=ft,E=Et,F=Ye;return a(),d("div",null,[s(o,{title:"泡泡详情",back:!0}),s(F,{class:"main-content-wrap",bordered:""},{default:n(()=>[s(L,null,{default:n(()=>[s(A,{show:c.value},{default:n(()=>[i.value.id>1?(a(),d("div",gs,[s(x,{post:i.value,onReload:S},null,8,["post"])])):(a(),d("div",hs,[s(h,{size:"large",description:"暂无数据"})]))]),_:1},8,["show"])]),_:1}),i.value.id>0?(a(),d("div",ys,[s(D,{justify:"space-between"},{default:n(()=>[ks,_("div",ws,[s(j,{type:"bar",size:"small",animated:"","onUpdate:value":l},{default:n(()=>[s(B,{name:"default",tab:"默认"}),s(B,{name:"newest",tab:"最新"})]),_:1})])]),_:1})])):k("",!0),i.value.id>0?(a(),U(L,{key:1},{default:n(()=>[s(N,{lock:i.value.is_lock,"post-id":i.value.id,onPostSuccess:$[0]||($[0]=t=>f(!0))},null,8,["lock","post-id"])]),_:1})):k("",!0),i.value.id>0?(a(),d("div",bs,[R.value?(a(),d("div",$s,[s(V,{num:5})])):(a(),d("div",xs,[w.value.length===0?(a(),d("div",Cs,[s(h,{size:"large",description:"暂无评论，快来抢沙发"})])):k("",!0),(a(!0),d(te,null,se(w.value,t=>(a(),U(L,{key:t.id},{default:n(()=>[s(E,{comment:t,onReload:f},null,8,["comment"])]),_:2},1024))),128))]))])):k("",!0)]),_:1})])}}});const no=Y(Is,[["__scopeId","data-v-c8247a20"]]);export{no as default};
