import{d as G,r,_ as de,o as n,c as _,a as d,L as t,Y as a,e as I,M as T,K as U,O as i,U as e,Z as q,n as se,a3 as Te,F as oe,$ as ne,j as me,a4 as fe,a5 as ge,H as Ue,w as ze}from"./@vue-f70ab1bd.js";import{u as Z}from"./vuex-cc1858c6.js";import{f as ae}from"./formatTime-000dbebb.js";import{t as Pe,d as Re,e as Se,_ as W,f as Le,h as Ae,i as Me,j as Oe,g as De,k as qe,l as Ee,m as Be,n as je,o as Ne,s as He,v as Ve,p as Fe,q as Ye,r as Ke,u as Je}from"./index-fb0d9e0b.js";import{Y as le,V as Q}from"./IEnum-a180d93e.js";import{T as ye,e as ie,f as ke,g as ce,h as we,I as Ge,i as Qe,j as Ze,k as We,l as Xe,m as et,n as tt,o as st}from"./@vicons-477062ff.js";import{j as X,e as ee,J as be,b as ot,K as nt,o as ve,L as $e,v as at,w as lt,x as it,y as ct,z as ut,B as rt,M as _t,O as pt,i as dt,P as mt,a as vt,F as ht,I as ft,k as gt,H as yt,f as kt,g as wt}from"./naive-ui-f5d716a8.js";import{p as he,_ as Ce,a as bt,b as $t,c as Ct}from"./content-06815173.js";import{u as xe,b as xt}from"./vue-router-29025daf.js";import{_ as It}from"./post-skeleton-6ccba81c.js";import{l as Tt}from"./lodash-3329902d.js";import{a as Ut}from"./copy-to-clipboard-ca358197.js";import{_ as zt}from"./main-nav.vue_vue_type_style_index_0_lang-0c2c8d0d.js";import"./moment-b7869f98.js";import"./axios-707ed124.js";/* empty css               */import"./seemly-76b7b838.js";import"./vueuc-804c4158.js";import"./evtd-b614532e.js";import"./@css-render-66126308.js";import"./vooks-dfdd6eef.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-6a5c5852.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-8412e618.js";import"./treemate-25c27bff.js";import"./async-validator-dee29e8b.js";import"./date-fns-975a2d8f.js";import"./nonesir-video-29a967e9.js";import"./toggle-selection-93f4ad84.js";const Pt={class:"reply-item"},Rt={class:"header-wrap"},St={class:"username"},Lt={class:"reply-name"},At={class:"timestamp"},Mt={class:"base-wrap"},Ot={class:"content"},Dt={class:"reply-switch"},qt={class:"time-item"},Et={class:"actions"},Bt={class:"upvote-count"},jt=["onClick"],Nt={class:"upvote-count"},Ht={key:2,class:"action-item"},Vt=["onClick"],Ft=G({__name:"reply-item",props:{tweetId:null,reply:null},emits:["focusReply","reload"],setup(A,{emit:O}){const l=A,c=Z(),g=r(l.reply.is_thumbs_up==le.YES),h=r(l.reply.is_thumbs_down==le.YES),k=r(l.reply.thumbs_up_count),P=()=>{Pe({tweet_id:l.tweetId,comment_id:l.reply.comment_id,reply_id:l.reply.id}).then(m=>{g.value=!g.value,g.value?(k.value++,h.value=!1):k.value--}).catch(m=>{console.log(m)})},u=()=>{Re({tweet_id:l.tweetId,comment_id:l.reply.comment_id,reply_id:l.reply.id}).then(m=>{h.value=!h.value,h.value&&g.value&&(k.value--,g.value=!1)}).catch(m=>{console.log(m)})},$=()=>{O("focusReply",l.reply)},C=()=>{Se({id:l.reply.id}).then(m=>{window.$message.success("删除成功"),setTimeout(()=>{O("reload")},50)}).catch(m=>{console.log(m)})};return(m,R)=>{const s=de("router-link"),w=X,y=ee,b=be;return n(),_("div",Pt,[d("div",Rt,[d("div",St,[t(s,{class:"user-link",to:{name:"user",query:{username:l.reply.user.username}}},{default:a(()=>[I(T(l.reply.user.username),1)]),_:1},8,["to"]),d("span",Lt,T(l.reply.at_user_id>0?"回复":":"),1),l.reply.at_user_id>0?(n(),U(s,{key:0,class:"user-link",to:{name:"user",query:{username:l.reply.at_user.username}}},{default:a(()=>[I(T(l.reply.at_user.username),1)]),_:1},8,["to"])):i("",!0)]),d("div",At,[I(T(l.reply.ip_loc)+" ",1),e(c).state.userInfo.is_admin||e(c).state.userInfo.id===l.reply.user.id?(n(),U(b,{key:0,"negative-text":"取消","positive-text":"确认",onPositiveClick:C},{trigger:a(()=>[t(y,{quaternary:"",circle:"",size:"tiny",class:"del-btn"},{icon:a(()=>[t(w,null,{default:a(()=>[t(e(ye))]),_:1})]),_:1})]),default:a(()=>[I(" 是否确认删除？ ")]),_:1})):i("",!0)])]),d("div",Mt,[d("div",Ot,T(l.reply.content),1),d("div",Dt,[d("span",qt,T(e(ae)(l.reply.created_on)),1),d("div",Et,[e(c).state.userLogined?i("",!0):(n(),_("div",{key:0,class:"action-item",onClick:R[0]||(R[0]=q(()=>{},["stop"]))},[t(w,{size:"medium"},{default:a(()=>[t(e(ie))]),_:1}),d("span",Bt,T(k.value),1)])),e(c).state.userLogined?(n(),_("div",{key:1,class:"action-item hover",onClick:q(P,["stop"])},[t(w,{size:"medium"},{default:a(()=>[g.value?i("",!0):(n(),U(e(ie),{key:0})),g.value?(n(),U(e(ke),{key:1,class:"show"})):i("",!0)]),_:1}),d("span",Nt,T(k.value),1)],8,jt)):i("",!0),e(c).state.userLogined?i("",!0):(n(),_("div",Ht,[t(w,{size:"medium"},{default:a(()=>[t(e(ce))]),_:1})])),e(c).state.userLogined?(n(),_("div",{key:3,class:"action-item hover",onClick:q(u,["stop"])},[t(w,{size:"medium"},{default:a(()=>[h.value?i("",!0):(n(),U(e(ce),{key:0})),h.value?(n(),U(e(we),{key:1,class:"show"})):i("",!0)]),_:1})],8,Vt)):i("",!0),e(c).state.userLogined?(n(),_("span",{key:4,class:"show opacity-item reply-btn",onClick:$}," 回复 ")):i("",!0)])])])])}}});const Yt=W(Ft,[["__scopeId","data-v-783f5693"]]),Kt={class:"reply-compose-wrap"},Jt={class:"reply-switch"},Gt={class:"time-item"},Qt={class:"actions"},Zt={key:0,class:"action-item"},Wt={class:"upvote-count"},Xt=["onClick"],es={class:"upvote-count"},ts={key:2,class:"action-item"},ss=["onClick"],os={key:0,class:"reply-input-wrap"},ns=G({__name:"compose-reply",props:{comment:null,atUserid:{default:0},atUsername:{default:""}},emits:["reload","reset"],setup(A,{expose:O,emit:l}){const c=A,g=Z(),h=r(),k=r(!1),P=r(""),u=r(!1),$=r(c.comment.is_thumbs_up==le.YES),C=r(c.comment.is_thumbs_down==le.YES),m=r(c.comment.thumbs_up_count),R=()=>{Le({tweet_id:c.comment.post_id,comment_id:c.comment.id}).then(b=>{$.value=!$.value,$.value?(m.value++,C.value=!1):m.value--}).catch(b=>{console.log(b)})},s=()=>{Ae({tweet_id:c.comment.post_id,comment_id:c.comment.id}).then(b=>{C.value=!C.value,C.value&&$.value&&(m.value--,$.value=!1)}).catch(b=>{console.log(b)})},w=b=>{k.value=b,b?setTimeout(()=>{var z;(z=h.value)==null||z.focus()},10):(u.value=!1,P.value="",l("reset"))},y=()=>{u.value=!0,Me({comment_id:c.comment.id,at_user_id:c.atUserid,content:P.value}).then(b=>{w(!1),window.$message.success("评论成功"),l("reload")}).catch(b=>{u.value=!1})};return O({switchReply:w}),(b,z)=>{const L=X,M=ot,N=ee,H=nt;return n(),_("div",Kt,[d("div",Jt,[d("span",Gt,T(e(ae)(A.comment.created_on)),1),d("div",Qt,[e(g).state.userLogined?i("",!0):(n(),_("div",Zt,[t(L,{size:"medium"},{default:a(()=>[t(e(ie))]),_:1}),d("span",Wt,T(m.value),1)])),e(g).state.userLogined?(n(),_("div",{key:1,class:"action-item hover",onClick:q(R,["stop"])},[t(L,{size:"medium"},{default:a(()=>[$.value?i("",!0):(n(),U(e(ie),{key:0})),$.value?(n(),U(e(ke),{key:1,class:"show"})):i("",!0)]),_:1}),d("span",es,T(m.value),1)],8,Xt)):i("",!0),e(g).state.userLogined?i("",!0):(n(),_("div",ts,[t(L,{size:"medium"},{default:a(()=>[t(e(ce))]),_:1})])),e(g).state.userLogined?(n(),_("div",{key:3,class:"action-item hover",onClick:q(s,["stop"])},[t(L,{size:"medium"},{default:a(()=>[C.value?i("",!0):(n(),U(e(ce),{key:0})),C.value?(n(),U(e(we),{key:1,class:"show"})):i("",!0)]),_:1})],8,ss)):i("",!0),e(g).state.userLogined&&!k.value?(n(),_("span",{key:4,class:"show reply-btn",onClick:z[0]||(z[0]=D=>w(!0))}," 回复 ")):i("",!0),e(g).state.userLogined&&k.value?(n(),_("span",{key:5,class:"hide reply-btn",onClick:z[1]||(z[1]=D=>w(!1))}," 取消 ")):i("",!0)])]),k.value?(n(),_("div",os,[t(H,null,{default:a(()=>[t(M,{ref_key:"inputInstRef",ref:h,size:"small",placeholder:c.atUsername?"@"+c.atUsername:"请输入回复内容..",maxlength:"100",value:P.value,"onUpdate:value":z[2]||(z[2]=D=>P.value=D),"show-count":"",clearable:""},null,8,["placeholder","value"]),t(N,{type:"primary",size:"small",ghost:"",loading:u.value,onClick:y},{default:a(()=>[I(" 回复 ")]),_:1},8,["loading"])]),_:1})])):i("",!0)])}}});const as=W(ns,[["__scopeId","data-v-0f1721e2"]]),ls={class:"comment-item"},is={class:"nickname-wrap"},cs={class:"username-wrap"},us={class:"opt-wrap"},rs={class:"timestamp"},_s=["innerHTML"],ps={class:"reply-wrap"},ds=G({__name:"comment-item",props:{comment:null},emits:["reload"],setup(A,{emit:O}){const l=A,c=Z(),g=xe(),h=r(0),k=r(""),P=r(),u=se(()=>{let w=Object.assign({texts:[],imgs:[]},l.comment);return w.contents.map(y=>{(+y.type==1||+y.type==2)&&w.texts.push(y),+y.type==3&&w.imgs.push(y)}),w}),$=(w,y)=>{let b=w.target;if(b.dataset.detail){const z=b.dataset.detail.split(":");z.length===2&&(c.commit("refresh"),z[0]==="tag"?window.$message.warning("评论内的无效话题"):g.push({name:"user",query:{username:z[1]}}))}},C=w=>{var y,b;h.value=w.user_id,k.value=((y=w.user)==null?void 0:y.username)||"",(b=P.value)==null||b.switchReply(!0)},m=()=>{O("reload")},R=()=>{h.value=0,k.value=""},s=()=>{Oe({id:u.value.id}).then(w=>{window.$message.success("删除成功"),setTimeout(()=>{m()},50)}).catch(w=>{})};return(w,y)=>{const b=ve,z=de("router-link"),L=X,M=ee,N=be,H=Ce,D=as,Y=Yt,V=$e;return n(),_("div",ls,[t(V,{"content-indented":""},Te({avatar:a(()=>[t(b,{round:"",size:30,src:e(u).user.avatar},null,8,["src"])]),header:a(()=>[d("span",is,[t(z,{onClick:y[0]||(y[0]=q(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{username:e(u).user.username}}},{default:a(()=>[I(T(e(u).user.nickname),1)]),_:1},8,["to"])]),d("span",cs," @"+T(e(u).user.username),1)]),"header-extra":a(()=>[d("div",us,[d("span",rs,T(e(u).ip_loc),1),e(c).state.userInfo.is_admin||e(c).state.userInfo.id===e(u).user.id?(n(),U(N,{key:0,"negative-text":"取消","positive-text":"确认",onPositiveClick:s},{trigger:a(()=>[t(M,{quaternary:"",circle:"",size:"tiny",class:"del-btn"},{icon:a(()=>[t(L,null,{default:a(()=>[t(e(ye))]),_:1})]),_:1})]),default:a(()=>[I(" 是否确认删除？ ")]),_:1})):i("",!0)])]),footer:a(()=>[e(u).imgs.length>0?(n(),U(H,{key:0,imgs:e(u).imgs},null,8,["imgs"])):i("",!0),t(D,{ref_key:"replyComposeRef",ref:P,comment:e(u),"at-userid":h.value,"at-username":k.value,onReload:m,onReset:R},null,8,["comment","at-userid","at-username"]),d("div",ps,[(n(!0),_(oe,null,ne(e(u).replies,o=>(n(),U(Y,{key:o.id,reply:o,"tweet-id":e(u).post_id,onFocusReply:C,onReload:m},null,8,["reply","tweet-id"]))),128))])]),_:2},[e(u).texts.length>0?{name:"description",fn:a(()=>[(n(!0),_(oe,null,ne(e(u).texts,o=>(n(),_("span",{key:o.id,class:"comment-text",onClick:y[1]||(y[1]=q(p=>$(p,e(u).id),["stop"])),innerHTML:e(he)(o.content).content},null,8,_s))),128))]),key:"0"}:void 0]),1024)])}}});const ms=W(ds,[["__scopeId","data-v-f206d4d8"]]),vs=A=>(fe("data-v-ca3e6071"),A=A(),ge(),A),hs={key:0,class:"compose-wrap"},fs={class:"compose-line"},gs={class:"compose-user"},ys={class:"compose-line compose-options"},ks={class:"attachment"},ws={class:"submit-wrap"},bs={class:"attachment-list-wrap"},$s={key:1,class:"compose-wrap"},Cs=vs(()=>d("div",{class:"login-wrap"},[d("span",{class:"login-banner"}," 登录后，精彩更多")],-1)),xs={key:0,class:"login-only-wrap"},Is={key:1,class:"login-wrap"},Ts=G({__name:"compose-comment",props:{lock:{default:0},postId:{default:0}},emits:["post-success"],setup(A,{emit:O}){const l=A,c=Z(),g=r([]),h=r(!1),k=r(!1),P=r(!1),u=r(""),$=r(),C=r("public/image"),m=r([]),R=r([]),s=r("true".toLowerCase()==="true"),w="/v1/attachment",y=r(),b=Tt.debounce(f=>{De({k:f}).then(v=>{let x=[];v.suggest.map(S=>{x.push({label:S,value:S})}),g.value=x,k.value=!1}).catch(v=>{k.value=!1})},200),z=(f,v)=>{k.value||(k.value=!0,v==="@"&&b(f))},L=f=>{f.length>200||(u.value=f)},M=f=>{C.value=f},N=f=>{m.value=f},H=async f=>{var v,x;return C.value==="public/image"&&!["image/png","image/jpg","image/jpeg","image/gif"].includes((v=f.file.file)==null?void 0:v.type)?(window.$message.warning("图片仅允许 png/jpg/gif 格式"),!1):C.value==="image"&&((x=f.file.file)==null?void 0:x.size)>10485760?(window.$message.warning("图片大小不能超过10MB"),!1):!0},D=({file:f,event:v})=>{var x;try{let S=JSON.parse((x=v.target)==null?void 0:x.response);S.code===0&&C.value==="public/image"&&R.value.push({id:f.id,content:S.data.content})}catch{window.$message.error("上传失败")}},Y=({file:f,event:v})=>{var x;try{let S=JSON.parse((x=v.target)==null?void 0:x.response);if(S.code!==0){let F=S.msg||"上传失败";S.details&&S.details.length>0&&S.details.map(E=>{F+=":"+E}),window.$message.error(F)}}catch{window.$message.error("上传失败")}},V=({file:f})=>{let v=R.value.findIndex(x=>x.id===f.id);v>-1&&R.value.splice(v,1)},o=()=>{h.value=!0},p=()=>{var f;h.value=!1,(f=$.value)==null||f.clear(),m.value=[],u.value="",R.value=[]},j=()=>{if(u.value.trim().length===0){window.$message.warning("请输入内容哦");return}let{users:f}=he(u.value);const v=[];let x=100;v.push({content:u.value,type:2,sort:x}),R.value.map(S=>{x++,v.push({content:S.content,type:3,sort:x})}),P.value=!0,qe({contents:v,post_id:l.postId,users:Array.from(new Set(f))}).then(S=>{window.$message.success("发布成功"),P.value=!1,O("post-success"),p()}).catch(S=>{P.value=!1})},K=f=>{c.commit("triggerAuth",!0),c.commit("triggerAuthKey",f)};return me(()=>{y.value="Bearer "+localStorage.getItem("PAOPAO_TOKEN")}),(f,v)=>{const x=ve,S=at,F=X,E=ee,ue=lt,re=it,_e=ct,te=ut,pe=rt;return n(),_("div",null,[e(c).state.userInfo.id>0?(n(),_("div",hs,[d("div",fs,[d("div",gs,[t(x,{round:"",size:30,src:e(c).state.userInfo.avatar},null,8,["src"])]),t(S,{type:"textarea",size:"large",autosize:"",bordered:!1,options:g.value,prefix:["@"],loading:k.value,value:u.value,disabled:l.lock===1,"onUpdate:value":L,onSearch:z,onFocus:o,placeholder:l.lock===1?"泡泡已被锁定，回复功能已关闭":"快来评论两句吧..."},null,8,["options","loading","value","disabled","placeholder"])]),h.value?(n(),U(pe,{key:0,ref_key:"uploadRef",ref:$,abstract:"","list-type":"image",multiple:!0,max:9,action:w,headers:{Authorization:y.value},data:{type:C.value},onBeforeUpload:H,onFinish:D,onError:Y,onRemove:V,"onUpdate:fileList":N},{default:a(()=>[d("div",ys,[d("div",ks,[t(ue,{abstract:""},{default:a(({handleClick:J})=>[t(E,{disabled:m.value.length>0&&C.value==="public/video"||m.value.length===9,onClick:()=>{M("public/image"),J()},quaternary:"",circle:"",type:"primary"},{icon:a(()=>[t(F,{size:"20",color:"var(--primary-color)"},{default:a(()=>[t(e(Ge))]),_:1})]),_:2},1032,["disabled","onClick"])]),_:1}),t(_e,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[t(re,{class:"text-statistic",type:"circle","show-indicator":!1,status:"success","stroke-width":10,percentage:u.value.length/200*100},null,8,["percentage"])]),default:a(()=>[I(" "+T(u.value.length)+" / 200 ",1)]),_:1})]),d("div",ws,[t(E,{quaternary:"",round:"",type:"tertiary",class:"cancel-btn",size:"small",onClick:p},{default:a(()=>[I(" 取消 ")]),_:1}),t(E,{loading:P.value,onClick:j,type:"primary",secondary:"",size:"small",round:""},{default:a(()=>[I(" 发布 ")]),_:1},8,["loading"])])]),d("div",bs,[t(te)])]),_:1},8,["headers","data"])):i("",!0)])):(n(),_("div",$s,[Cs,s.value?i("",!0):(n(),_("div",xs,[t(E,{strong:"",secondary:"",round:"",type:"primary",onClick:v[0]||(v[0]=J=>K("signin"))},{default:a(()=>[I(" 登录 ")]),_:1})])),s.value?(n(),_("div",Is,[t(E,{strong:"",secondary:"",round:"",type:"primary",onClick:v[1]||(v[1]=J=>K("signin"))},{default:a(()=>[I(" 登录 ")]),_:1}),t(E,{strong:"",secondary:"",round:"",type:"info",onClick:v[2]||(v[2]=J=>K("signup"))},{default:a(()=>[I(" 注册 ")]),_:1})])):i("",!0)]))])}}});const Us=W(Ts,[["__scopeId","data-v-ca3e6071"]]),zs={class:"username-wrap"},Ps={key:0,class:"options"},Rs={key:0},Ss=["innerHTML"],Ls={class:"timestamp"},As={key:0},Ms={key:1},Os={class:"opts-wrap"},Ds=["onClick"],qs={class:"opt-item"},Es=["onClick"],Bs=["onClick"],js=G({__name:"post-detail",props:{post:null},emits:["reload"],setup(A,{emit:O}){const l=A,c=Z(),g=xe(),h=r(!1),k=r(!1),P=r(!1),u=r(!1),$=r(!1),C=r(!1),m=r(!1),R=r(Q.PUBLIC),s=se({get:()=>{let o=Object.assign({texts:[],imgs:[],videos:[],links:[],attachments:[],charge_attachments:[]},l.post);return o.contents.map(p=>{(+p.type==1||+p.type==2)&&o.texts.push(p),+p.type==3&&o.imgs.push(p),+p.type==4&&o.videos.push(p),+p.type==6&&o.links.push(p),+p.type==7&&o.attachments.push(p),+p.type==8&&o.charge_attachments.push(p)}),o},set:o=>{l.post.upvote_count=o.upvote_count,l.post.comment_count=o.comment_count,l.post.collection_count=o.collection_count}}),w=se(()=>{let o=[{label:"删除",key:"delete"}];return s.value.is_lock===0?o.push({label:"锁定",key:"lock"}):o.push({label:"解锁",key:"unlock"}),c.state.userInfo.is_admin&&(s.value.is_top===0?o.push({label:"置顶",key:"stick"}):o.push({label:"取消置顶",key:"unstick"})),s.value.visibility===Q.PUBLIC?o.push({label:"公开",key:"vpublic",children:[{label:"私密",key:"vprivate"},{label:"好友可见",key:"vfriend"}]}):s.value.visibility===Q.PRIVATE?o.push({label:"私密",key:"vprivate",children:[{label:"公开",key:"vpublic"},{label:"好友可见",key:"vfriend"}]}):o.push({label:"好友可见",key:"vfriend",children:[{label:"公开",key:"vpublic"},{label:"私密",key:"vprivate"}]}),o}),y=o=>{g.push({name:"post",query:{id:o}})},b=(o,p)=>{if(o.target.dataset.detail){const j=o.target.dataset.detail.split(":");if(j.length===2){c.commit("refresh"),j[0]==="tag"?g.push({name:"home",query:{q:j[1],t:"tag"}}):g.push({name:"user",query:{username:j[1]}});return}}y(p)},z=o=>{switch(o){case"delete":P.value=!0;break;case"lock":case"unlock":u.value=!0;break;case"stick":case"unstick":$.value=!0;break;case"vpublic":R.value=0,C.value=!0;break;case"vprivate":R.value=1,C.value=!0;break;case"vfriend":R.value=2,C.value=!0;break}},L=()=>{je({id:s.value.id}).then(o=>{window.$message.success("删除成功"),g.replace("/"),setTimeout(()=>{c.commit("refresh")},50)}).catch(o=>{m.value=!1})},M=()=>{Ne({id:s.value.id}).then(o=>{O("reload"),o.lock_status===1?window.$message.success("锁定成功"):window.$message.success("解锁成功")}).catch(o=>{m.value=!1})},N=()=>{He({id:s.value.id}).then(o=>{O("reload"),o.top_status===1?window.$message.success("置顶成功"):window.$message.success("取消置顶成功")}).catch(o=>{m.value=!1})},H=()=>{Ve({id:s.value.id,visibility:R.value}).then(o=>{O("reload"),window.$message.success("修改可见性成功")}).catch(o=>{m.value=!1})},D=()=>{Fe({id:s.value.id}).then(o=>{h.value=o.status,o.status?s.value={...s.value,upvote_count:s.value.upvote_count+1}:s.value={...s.value,upvote_count:s.value.upvote_count-1}}).catch(o=>{console.log(o)})},Y=()=>{Ye({id:s.value.id}).then(o=>{k.value=o.status,o.status?s.value={...s.value,collection_count:s.value.collection_count+1}:s.value={...s.value,collection_count:s.value.collection_count-1}}).catch(o=>{console.log(o)})},V=()=>{Ut(`${window.location.origin}/#/post?id=${s.value.id}`),window.$message.success("链接已复制到剪贴板")};return me(()=>{c.state.userInfo.id>0&&(Ee({id:s.value.id}).then(o=>{h.value=o.status}).catch(o=>{console.log(o)}),Be({id:s.value.id}).then(o=>{k.value=o.status}).catch(o=>{console.log(o)}))}),(o,p)=>{const j=ve,K=de("router-link"),f=_t,v=X,x=ee,S=pt,F=dt,E=bt,ue=Ce,re=$t,_e=Ct,te=mt,pe=vt,J=$e;return n(),_("div",{class:"detail-item",onClick:p[6]||(p[6]=B=>y(e(s).id))},[t(J,null,{avatar:a(()=>[t(j,{round:"",size:30,src:e(s).user.avatar},null,8,["src"])]),header:a(()=>[t(K,{onClick:p[0]||(p[0]=q(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{username:e(s).user.username}}},{default:a(()=>[I(T(e(s).user.nickname),1)]),_:1},8,["to"]),d("span",zs," @"+T(e(s).user.username),1),e(s).is_top?(n(),U(f,{key:0,class:"top-tag",type:"warning",size:"small",round:""},{default:a(()=>[I(" 置顶 ")]),_:1})):i("",!0),e(s).visibility==e(Q).PRIVATE?(n(),U(f,{key:1,class:"top-tag",type:"error",size:"small",round:""},{default:a(()=>[I(" 私密 ")]),_:1})):i("",!0),e(s).visibility==e(Q).FRIEND?(n(),U(f,{key:2,class:"top-tag",type:"info",size:"small",round:""},{default:a(()=>[I(" 好友可见 ")]),_:1})):i("",!0)]),"header-extra":a(()=>[e(c).state.userInfo.is_admin||e(c).state.userInfo.id===e(s).user.id?(n(),_("div",Ps,[t(S,{placement:"bottom-end",trigger:"click",size:"small",options:e(w),onSelect:z},{default:a(()=>[t(x,{quaternary:"",circle:""},{icon:a(()=>[t(v,null,{default:a(()=>[t(e(Qe))]),_:1})]),_:1})]),_:1},8,["options"])])):i("",!0),t(F,{show:P.value,"onUpdate:show":p[1]||(p[1]=B=>P.value=B),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定删除该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:L},null,8,["show"]),t(F,{show:u.value,"onUpdate:show":p[2]||(p[2]=B=>u.value=B),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定"+(e(s).is_lock?"解锁":"锁定")+"该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:M},null,8,["show","content"]),t(F,{show:$.value,"onUpdate:show":p[3]||(p[3]=B=>$.value=B),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定"+(e(s).is_top?"取消置顶":"置顶")+"该泡泡动态吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:N},null,8,["show","content"]),t(F,{show:C.value,"onUpdate:show":p[4]||(p[4]=B=>C.value=B),"mask-closable":!1,preset:"dialog",title:"提示",content:"确定将该泡泡动态可见度修改为"+(R.value==0?"公开":R.value==1?"私密":"好友可见")+"吗？","positive-text":"确认","negative-text":"取消",onPositiveClick:H},null,8,["show","content"])]),footer:a(()=>[t(E,{attachments:e(s).attachments},null,8,["attachments"]),t(E,{attachments:e(s).charge_attachments,price:e(s).attachment_price},null,8,["attachments","price"]),t(ue,{imgs:e(s).imgs},null,8,["imgs"]),t(re,{videos:e(s).videos,full:!0},null,8,["videos"]),t(_e,{links:e(s).links},null,8,["links"]),d("div",Ls,[I(" 发布于 "+T(e(ae)(e(s).created_on))+" ",1),e(s).ip_loc?(n(),_("span",As,[t(te,{vertical:""}),I(" "+T(e(s).ip_loc),1)])):i("",!0),!e(c).state.collapsedLeft&&e(s).created_on!=e(s).latest_replied_on?(n(),_("span",Ms,[t(te,{vertical:""}),I(" 最后回复 "+T(e(ae)(e(s).latest_replied_on)),1)])):i("",!0)])]),action:a(()=>[d("div",Os,[t(pe,{justify:"space-between"},{default:a(()=>[d("div",{class:"opt-item hover",onClick:q(D,["stop"])},[t(v,{size:"20",class:"opt-item-icon"},{default:a(()=>[h.value?i("",!0):(n(),U(e(Ze),{key:0})),h.value?(n(),U(e(We),{key:1,color:"red"})):i("",!0)]),_:1}),I(" "+T(e(s).upvote_count),1)],8,Ds),d("div",qs,[t(v,{size:"20",class:"opt-item-icon"},{default:a(()=>[t(e(Xe))]),_:1}),I(" "+T(e(s).comment_count),1)]),d("div",{class:"opt-item hover",onClick:q(Y,["stop"])},[t(v,{size:"20",class:"opt-item-icon"},{default:a(()=>[k.value?i("",!0):(n(),U(e(et),{key:0})),k.value?(n(),U(e(tt),{key:1,color:"#ff7600"})):i("",!0)]),_:1}),I(" "+T(e(s).collection_count),1)],8,Es),d("div",{class:"opt-item hover",onClick:q(V,["stop"])},[t(v,{size:"20",class:"opt-item-icon"},{default:a(()=>[t(e(st))]),_:1}),I(" "+T(e(s).share_count),1)],8,Bs)]),_:1})])]),default:a(()=>[e(s).texts.length>0?(n(),_("div",Rs,[(n(!0),_(oe,null,ne(e(s).texts,B=>(n(),_("span",{key:B.id,class:"post-text",onClick:p[5]||(p[5]=q(Ie=>b(Ie,e(s).id),["stop"])),innerHTML:e(he)(B.content).content},null,8,Ss))),128))])):i("",!0)]),_:1})])}}});const Ns=A=>(fe("data-v-398952d0"),A=A(),ge(),A),Hs={key:0,class:"detail-wrap"},Vs={key:1,class:"empty-wrap"},Fs={key:0,class:"comment-opts-wrap"},Ys=Ns(()=>d("span",{class:"comment-title-item"},"评论",-1)),Ks={key:2},Js={key:0,class:"skeleton-wrap"},Gs={key:1},Qs={key:0,class:"empty-wrap"},Zs=G({__name:"Post",setup(A){const O=xt(),l=r({}),c=r(!1),g=r(!1),h=r([]),k=se(()=>+O.query.id),P=r("default"),u=r(null),$=r(1),C=r(!1),m=20,R=L=>{P.value=L,$.value=1,h.value=[],u.value=null,y()},s=()=>{l.value={id:0},c.value=!0,Ke({id:k.value}).then(L=>{c.value=!1,l.value=L,y()}).catch(L=>{c.value=!1})},w=()=>{$.value=1,h.value=[],u.value=null,y()},y=(L=!1)=>{h.value.length===0&&(g.value=!0),Je({id:l.value.id,sort_strategy:P.value,page:$.value,page_size:m}).then(M=>{(M.list.length===0||$.value===1&&M.list.length<m)&&(C.value=!0),$.value===1?h.value=M.list:h.value=h.value.concat(M.list),g.value=!1,L&&setTimeout(()=>{window.scrollTo(0,99999)},50)}).catch(M=>{g.value=!1})},b=()=>{!g.value&&h.value.length>=m&&($.value=$.value+1,y())},z=new IntersectionObserver(L=>{L.forEach(M=>{M.isIntersecting&&b()})},{root:null,rootMargin:"0px",threshold:1});return me(()=>{u.value&&z.observe(u.value),s()}),Ue(()=>{z.disconnect()}),ze(k,()=>{k.value>0&&O.name==="post"&&s()}),(L,M)=>{const N=zt,H=js,D=ft,Y=gt,V=yt,o=kt,p=wt,j=Us,K=It,f=ms,v=ht;return n(),_("div",null,[t(N,{title:"泡泡详情",back:!0}),t(v,{class:"main-content-wrap",bordered:""},{default:a(()=>[t(V,null,{default:a(()=>[t(Y,{show:c.value},{default:a(()=>[l.value.id>1?(n(),_("div",Hs,[t(H,{post:l.value,onReload:s},null,8,["post"])])):(n(),_("div",Vs,[t(D,{size:"large",description:"暂无数据"})]))]),_:1},8,["show"])]),_:1}),l.value.id>0?(n(),_("div",Fs,[t(p,{type:"bar","justify-content":"end",size:"small",animated:"","onUpdate:value":R},{prefix:a(()=>[Ys]),default:a(()=>[t(o,{name:"default",tab:"默认"}),t(o,{name:"newest",tab:"最新"})]),_:1})])):i("",!0),l.value.id>0?(n(),U(V,{key:1},{default:a(()=>[t(j,{lock:l.value.is_lock,"post-id":l.value.id,onPostSuccess:M[0]||(M[0]=x=>y(!0))},null,8,["lock","post-id"])]),_:1})):i("",!0),l.value.id>0?(n(),_("div",Ks,[g.value?(n(),_("div",Js,[t(K,{num:5})])):(n(),_("div",Gs,[h.value.length===0?(n(),_("div",Qs,[t(D,{size:"large",description:"暂无评论，快来抢沙发"})])):i("",!0),(n(!0),_(oe,null,ne(h.value,x=>(n(),U(V,{key:x.id},{default:a(()=>[t(f,{comment:x,onReload:w},null,8,["comment"])]),_:2},1024))),128))]))])):i("",!0),C.value?i("",!0):(n(),_("div",{key:3,class:"load-more-ele",ref_key:"bottomElement",ref:u}," 加载更多... ",512))]),_:1})])}}});const Po=W(Zs,[["__scopeId","data-v-398952d0"]]);export{Po as default};
