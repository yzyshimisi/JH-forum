import{_ as Ce}from"./main-nav.3ee5cea4.js";import{d as ae,W as l,Y as m,Z as d,ai as we,r as c,ci as ee,a2 as Be,af as De,a4 as u,a5 as t,a6 as B,a7 as v,$ as ye,cE as ue,aA as ke,a3 as i,a9 as p,aa as $,b4 as be,b5 as Ee,bu as P,cF as Ae,cG as Ie,cH as $e,cI as Pe,cJ as Ue,cK as Se,ae as Re,K as xe,_ as qe,cL as Ne,cM as Ke,cN as ze,cO as Me,a8 as U,bW as Le,bX as Oe}from"./index.e74a6972.js";import{c as Te}from"./Upload.4d819f73.js";import{_ as Ve}from"./Alert.9a626815.js";import{_ as je}from"./InputGroup.be02a9e1.js";const We={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ge=d("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[d("path",{d:"M9 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-3"}),d("path",{d:"M9 15h3l8.5-8.5a1.5 1.5 0 0 0-3-3L9 12v3"}),d("path",{d:"M16 5l3 3"})],-1),He=[Ge];var Je=ae({name:"Edit",render:function(j,W){return l(),m("svg",We,He)}});const z=k=>(Le("data-v-6eb93a4d"),k=k(),Oe(),k),Xe={class:"base-line avatar"},Ye={class:"base-line"},Ze=z(()=>d("span",{class:"base-label"},"\u6635\u79F0",-1)),Qe={key:0},eu={class:"base-line"},uu=z(()=>d("span",{class:"base-label"},"\u7528\u6237\u540D",-1)),au={key:0},tu={key:1},su=z(()=>d("br",null,null,-1)),nu={key:2,class:"phone-bind-wrap"},ou={class:"captcha-img-wrap"},lu={class:"captcha-img"},ru=["src"],iu={class:"form-submit-wrap"},du={key:0},cu={key:1},pu=z(()=>d("br",null,null,-1)),_u={key:2,class:"phone-bind-wrap"},vu={class:"captcha-img-wrap"},mu={class:"captcha-img"},fu=["src"],hu={class:"form-submit-wrap"},gu={key:1,class:"phone-bind-wrap"},Fu={class:"form-submit-wrap"},Cu=ae({__name:"Setting",setup(k){const j="/v1/attachment",W="Bearer "+localStorage.getItem("PAOPAO_TOKEN"),S=c("public/avatar"),b="true".toLowerCase()==="true",te="false".toLowerCase()==="true",n=ye(),E=c(!1),R=c(!1),x=c(!1),G=c(),H=c(),D=c(!1),q=c(!1),A=c(!1),I=c(!1),y=c(60),C=c(!1),w=c(!1),J=c(),X=c(),Y=c(),Z=c(),a=ee({id:"",b64s:"",imgCaptcha:"",phone:"",phone_captcha:"",password:"",old_password:"",reenteredPassword:""}),r=ee({id:"",b64s:"",imgCaptcha:"",activate_code:""}),se=async s=>{var e,f;return S.value==="public/avatar"&&!["image/png","image/jpg","image/jpeg"].includes((e=s.file.file)==null?void 0:e.type)?(window.$message.warning("\u5934\u50CF\u4EC5\u5141\u8BB8 png/jpg \u683C\u5F0F"),!1):S.value==="image"&&((f=s.file.file)==null?void 0:f.size)>1048576?(window.$message.warning("\u5934\u50CF\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC71MB"),!1):!0},ne=({file:s,event:e})=>{var f;try{let h=JSON.parse((f=e.target)==null?void 0:f.response);h.code===0&&S.value==="public/avatar"&&Ae({avatar:h.data.content}).then(_=>{var N;window.$message.success("\u5934\u50CF\u66F4\u65B0\u6210\u529F"),(N=G.value)==null||N.clear(),n.commit("updateUserinfo",{...n.state.userInfo,avatar:h.data.content})}).catch(_=>{console.log(_)})}catch{window.$message.error("\u4E0A\u4F20\u5931\u8D25")}},oe=(s,e)=>!!a.password&&a.password.startsWith(e)&&a.password.length>=e.length,le=(s,e)=>e===a.password,re=()=>{var s;a.reenteredPassword&&((s=Z.value)==null||s.validate({trigger:"password-input"}))},ie=s=>{var e;s.preventDefault(),(e=Y.value)==null||e.validate(f=>{f||(q.value=!0,Ie({password:a.password,old_password:a.old_password}).then(h=>{q.value=!1,A.value=!1,window.$message.success("\u5BC6\u7801\u91CD\u7F6E\u6210\u529F"),n.commit("userLogout"),n.commit("triggerAuth",!0),n.commit("triggerAuthKey","signin")}).catch(h=>{q.value=!1}))})},de=s=>{var e;s.preventDefault(),(e=J.value)==null||e.validate(f=>{f||(R.value=!0,$e({phone:a.phone,captcha:a.phone_captcha}).then(h=>{R.value=!1,C.value=!1,window.$message.success("\u7ED1\u5B9A\u6210\u529F"),n.commit("updateUserinfo",{...n.state.userInfo,phone:a.phone}),a.id="",a.b64s="",a.imgCaptcha="",a.phone="",a.phone_captcha=""}).catch(h=>{R.value=!1}))})},ce=s=>{var e;s.preventDefault(),(e=X.value)==null||e.validate(f=>{if(r.imgCaptcha===""){window.$message.warning("\u8BF7\u8F93\u5165\u56FE\u7247\u9A8C\u8BC1\u7801");return}E.value=!0,f||(x.value=!0,Pe({activate_code:r.activate_code,captcha_id:r.id,imgCaptcha:r.imgCaptcha}).then(h=>{x.value=!1,w.value=!1,window.$message.success("\u6FC0\u6D3B\u6210\u529F"),n.commit("updateUserinfo",{...n.state.userInfo,activation:r.activate_code}),r.id="",r.b64s="",r.imgCaptcha="",r.activate_code=""}).catch(h=>{x.value=!1,h.code===20012&&L()}))})},M=()=>{ue().then(s=>{a.id=s.id,a.b64s=s.b64s}).catch(s=>{console.log(s)})},L=()=>{ue().then(s=>{r.id=s.id,r.b64s=s.b64s}).catch(s=>{console.log(s)})},pe=()=>{Ue({nickname:n.state.userInfo.nickname||""}).then(s=>{D.value=!1,window.$message.success("\u6635\u79F0\u4FEE\u6539\u6210\u529F")}).catch(s=>{D.value=!0})},_e=()=>{if(!(y.value>0&&I.value)){if(a.imgCaptcha===""){window.$message.warning("\u8BF7\u8F93\u5165\u56FE\u7247\u9A8C\u8BC1\u7801");return}E.value=!0,Se({phone:a.phone,img_captcha:a.imgCaptcha,img_captcha_id:a.id}).then(s=>{I.value=!0,E.value=!1,window.$message.success("\u53D1\u9001\u6210\u529F");let e=setInterval(()=>{y.value--,y.value===0&&(clearInterval(e),y.value=60,I.value=!1)},1e3)}).catch(s=>{E.value=!1,s.code===20012&&M(),console.log(s)})}},ve={phone:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:["input"],validator:(s,e)=>/^[1]+[3-9]{1}\d{9}$/.test(e)}],phone_captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u9A8C\u8BC1\u7801"}]},me={activate_code:[{required:!0,message:"\u8BF7\u8F93\u5165\u6FC0\u6D3B\u7801",trigger:["input"],validator:(s,e)=>/\d{6}$/.test(e)}]},fe={password:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"}],old_password:[{required:!0,message:"\u8BF7\u8F93\u5165\u65E7\u5BC6\u7801"}],reenteredPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]},{validator:oe,message:"\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4",trigger:"input"},{validator:le,message:"\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4",trigger:["blur","password-input"]}]},he=()=>{D.value=!0,setTimeout(()=>{var s;(s=H.value)==null||s.focus()},30)};return Be(()=>{n.state.userInfo.id===0&&(n.commit("triggerAuth",!0),n.commit("triggerAuthKey","signin")),M(),L()}),(s,e)=>{const f=Ce,h=Re,_=xe,N=Te,g=qe,ge=De,K=ke,Q=Ve,F=Ne,Fe=je,O=Ke,T=ze,V=Me;return l(),m("div",null,[u(f,{title:"\u8BBE\u7F6E",theme:""}),u(K,{title:"\u57FA\u672C\u4FE1\u606F",size:"small",class:"setting-card"},{default:t(()=>[d("div",Xe,[u(h,{class:"avatar-img",size:80,src:i(n).state.userInfo.avatar},null,8,["src"]),!b||b&&i(n).state.userInfo.phone&&i(n).state.userInfo.phone.length>0?(l(),B(N,{key:0,ref_key:"avatarRef",ref:G,action:j,headers:{Authorization:W},data:{type:S.value},onBeforeUpload:se,onFinish:ne},{default:t(()=>[u(_,{size:"small"},{default:t(()=>[p("\u66F4\u6539\u5934\u50CF")]),_:1})]),_:1},8,["headers","data"])):v("",!0)]),d("div",Ye,[Ze,D.value?v("",!0):(l(),m("div",Qe,$(i(n).state.userInfo.nickname),1)),be(u(g,{ref_key:"inputInstRef",ref:H,class:"nickname-input",value:i(n).state.userInfo.nickname,"onUpdate:value":e[0]||(e[0]=o=>i(n).state.userInfo.nickname=o),type:"text",size:"small",placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",onBlur:pe,maxlength:16},null,8,["value"]),[[Ee,D.value]]),!D.value&&(!b||b&&i(n).state.userInfo.phone&&i(n).state.userInfo.phone.length>0&&i(n).state.userInfo.status==1)?(l(),B(_,{key:1,quaternary:"",round:"",type:"success",size:"small",onClick:he},{icon:t(()=>[u(ge,null,{default:t(()=>[u(i(Je))]),_:1})]),_:1})):v("",!0)]),d("div",eu,[uu,p(" @"+$(i(n).state.userInfo.username),1)])]),_:1}),b?(l(),B(K,{key:0,title:"\u624B\u673A\u53F7",size:"small",class:"setting-card"},{default:t(()=>[i(n).state.userInfo.phone&&i(n).state.userInfo.phone.length>0?(l(),m("div",au,[p($(i(n).state.userInfo.phone)+" ",1),!C.value&&i(n).state.userInfo.status==1?(l(),B(_,{key:0,quaternary:"",round:"",type:"success",onClick:e[1]||(e[1]=o=>C.value=!0)},{default:t(()=>[p(" \u6362\u7ED1\u624B\u673A ")]),_:1})):v("",!0)])):(l(),m("div",tu,[u(Q,{title:"\u624B\u673A\u7ED1\u5B9A\u63D0\u793A",type:"warning"},{default:t(()=>[p(" \u6210\u529F\u7ED1\u5B9A\u624B\u673A\u540E\uFF0C\u624D\u80FD\u8FDB\u884C\u6362\u5934\u50CF\u3001\u53D1\u52A8\u6001\u3001\u56DE\u590D\u7B49\u4EA4\u4E92~"),su,C.value?v("",!0):(l(),m("a",{key:0,class:"hash-link",onClick:e[2]||(e[2]=o=>C.value=!0)}," \u7ACB\u5373\u7ED1\u5B9A "))]),_:1})])),C.value?(l(),m("div",nu,[u(V,{ref_key:"phoneFormRef",ref:J,model:a,rules:ve},{default:t(()=>[u(F,{path:"phone",label:"\u624B\u673A\u53F7"},{default:t(()=>[u(g,{value:a.phone,"onUpdate:value":e[3]||(e[3]=o=>a.phone=o.trim()),placeholder:"\u8BF7\u8F93\u5165\u4E2D\u56FD\u5927\u9646\u624B\u673A\u53F7",onKeydown:e[4]||(e[4]=P(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),u(F,{path:"img_captcha",label:"\u56FE\u5F62\u9A8C\u8BC1\u7801"},{default:t(()=>[d("div",ou,[u(g,{value:a.imgCaptcha,"onUpdate:value":e[5]||(e[5]=o=>a.imgCaptcha=o),placeholder:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801\u540E\u83B7\u53D6\u9A8C\u8BC1\u7801"},null,8,["value"]),d("div",lu,[a.b64s?(l(),m("img",{key:0,src:a.b64s,onClick:M},null,8,ru)):v("",!0)])])]),_:1}),u(F,{path:"phone_captcha",label:"\u77ED\u4FE1\u9A8C\u8BC1\u7801"},{default:t(()=>[u(Fe,null,{default:t(()=>[u(g,{value:a.phone_captcha,"onUpdate:value":e[6]||(e[6]=o=>a.phone_captcha=o),placeholder:"\u8BF7\u8F93\u5165\u6536\u5230\u7684\u77ED\u4FE1\u9A8C\u8BC1\u7801"},null,8,["value"]),u(_,{type:"primary",ghost:"",disabled:I.value,loading:E.value,onClick:_e},{default:t(()=>[p($(y.value>0&&I.value?y.value+"s\u540E\u91CD\u65B0\u53D1\u9001":"\u53D1\u9001\u9A8C\u8BC1\u7801"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),u(T,{gutter:[0,24]},{default:t(()=>[u(O,{span:24},{default:t(()=>[d("div",iu,[u(_,{quaternary:"",round:"",onClick:e[7]||(e[7]=o=>C.value=!1)},{default:t(()=>[p(" \u53D6\u6D88 ")]),_:1}),u(_,{secondary:"",round:"",type:"primary",loading:R.value,onClick:de},{default:t(()=>[p(" \u7ED1\u5B9A ")]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["model"])])):v("",!0)]),_:1})):v("",!0),te?(l(),B(K,{key:1,title:"\u6FC0\u6D3B\u7801",size:"small",class:"setting-card"},{default:t(()=>[i(n).state.userInfo.activation&&i(n).state.userInfo.activation.length>0?(l(),m("div",du,[p($(i(n).state.userInfo.activation)+" ",1),w.value?v("",!0):(l(),B(_,{key:0,quaternary:"",round:"",type:"success",onClick:e[8]||(e[8]=o=>w.value=!0)},{default:t(()=>[p(" \u91CD\u65B0\u6FC0\u6D3B ")]),_:1}))])):(l(),m("div",cu,[u(Q,{title:"\u6FC0\u6D3B\u7801\u6FC0\u6D3B\u63D0\u793A",type:"warning"},{default:t(()=>[p(" \u6210\u529F\u6FC0\u6D3B\u540E\u540E\uFF0C\u624D\u80FD\u53D1\uFF08\u516C\u5F00/\u597D\u53CB\u53EF\u89C1\uFF09\u52A8\u6001\u3001\u56DE\u590D~"),pu,w.value?v("",!0):(l(),m("a",{key:0,class:"hash-link",onClick:e[9]||(e[9]=o=>w.value=!0)}," \u7ACB\u5373\u6FC0\u6D3B "))]),_:1})])),w.value?(l(),m("div",_u,[u(V,{ref_key:"activateFormRef",ref:X,model:r,rules:me},{default:t(()=>[u(F,{path:"activate_code",label:"\u6FC0\u6D3B\u7801"},{default:t(()=>[u(g,{value:r.activate_code,"onUpdate:value":e[10]||(e[10]=o=>r.activate_code=o.trim()),placeholder:"\u8BF7\u8F93\u5165\u6FC0\u6D3B\u7801",onKeydown:e[11]||(e[11]=P(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),u(F,{path:"img_captcha",label:"\u56FE\u5F62\u9A8C\u8BC1\u7801"},{default:t(()=>[d("div",vu,[u(g,{value:r.imgCaptcha,"onUpdate:value":e[12]||(e[12]=o=>r.imgCaptcha=o),placeholder:"\u8BF7\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801\u540E\u83B7\u53D6\u9A8C\u8BC1\u7801"},null,8,["value"]),d("div",mu,[r.b64s?(l(),m("img",{key:0,src:r.b64s,onClick:L},null,8,fu)):v("",!0)])])]),_:1}),u(T,{gutter:[0,24]},{default:t(()=>[u(O,{span:24},{default:t(()=>[d("div",hu,[u(_,{quaternary:"",round:"",onClick:e[13]||(e[13]=o=>w.value=!1)},{default:t(()=>[p(" \u53D6\u6D88 ")]),_:1}),u(_,{secondary:"",round:"",type:"primary",loading:x.value,onClick:ce},{default:t(()=>[p(" \u6FC0\u6D3B ")]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["model"])])):v("",!0)]),_:1})):v("",!0),u(K,{title:"\u8D26\u6237\u5B89\u5168",size:"small",class:"setting-card"},{default:t(()=>[p(" \u60A8\u5DF2\u8BBE\u7F6E\u5BC6\u7801 "),A.value?v("",!0):(l(),B(_,{key:0,quaternary:"",round:"",type:"success",onClick:e[14]||(e[14]=o=>A.value=!0)},{default:t(()=>[p(" \u91CD\u7F6E\u5BC6\u7801 ")]),_:1})),A.value?(l(),m("div",gu,[u(V,{ref_key:"formRef",ref:Y,model:a,rules:fe},{default:t(()=>[u(F,{path:"old_password",label:"\u65E7\u5BC6\u7801"},{default:t(()=>[u(g,{value:a.old_password,"onUpdate:value":e[15]||(e[15]=o=>a.old_password=o),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5F53\u524D\u5BC6\u7801",onKeydown:e[16]||(e[16]=P(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),u(F,{path:"password",label:"\u65B0\u5BC6\u7801"},{default:t(()=>[u(g,{value:a.password,"onUpdate:value":e[17]||(e[17]=o=>a.password=o),type:"password",placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",onInput:re,onKeydown:e[18]||(e[18]=P(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),u(F,{ref_key:"rPasswordFormItemRef",ref:Z,first:"",path:"reenteredPassword",label:"\u91CD\u590D\u5BC6\u7801"},{default:t(()=>[u(g,{value:a.reenteredPassword,"onUpdate:value":e[19]||(e[19]=o=>a.reenteredPassword=o),disabled:!a.password,type:"password",placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",onKeydown:e[20]||(e[20]=P(U(()=>{},["prevent"]),["enter"]))},null,8,["value","disabled"])]),_:1},512),u(T,{gutter:[0,24]},{default:t(()=>[u(O,{span:24},{default:t(()=>[d("div",Fu,[u(_,{quaternary:"",round:"",onClick:e[21]||(e[21]=o=>A.value=!1)},{default:t(()=>[p(" \u53D6\u6D88 ")]),_:1}),u(_,{secondary:"",round:"",type:"primary",loading:q.value,onClick:ie},{default:t(()=>[p(" \u66F4\u65B0 ")]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["model"])])):v("",!0)]),_:1})])}}});var bu=we(Cu,[["__scopeId","data-v-6eb93a4d"]]);export{bu as default};
