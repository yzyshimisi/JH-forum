import{_ as He,a as Ne}from"./post-item.vue_vue_type_style_index_0_lang-4d372959.js";import{_ as Re}from"./post-skeleton-a15059e0.js";import{_ as Ve}from"./whisper-29f2b0aa.js";import{_ as je}from"./main-nav.vue_vue_type_style_index_0_lang-a20a8596.js";import{d as Ee,H as i,R as Ge,c as Je,b as Ke,E as Ye,r as Qe,f as u,k as o,w as r,q as g,Y as m,e as s,j as w,x as I,bf as c,A as H,y as de,F,u as T,h as me}from"./@vue-a481fc63.js";import{u as Xe}from"./vuex-44de225f.js";import{b as Ze}from"./vue-router-e5a2430e.js";import{L as ea,K as aa,e as N,h as sa,u as fe,f as pe,M as ta,_ as la}from"./index-15a0e03b.js";import{W as na}from"./whisper-add-friend-78adb41e.js";import{W as oa}from"./v3-infinite-loading-2c58ec2f.js";import{k as ua,r as ia,G as he,s as ra,t as ca,J as va,R as _a}from"./@vicons-f0266f88.js";import{F as da,G as ma,a as fa,j as ge,o as pa,M as ha,e as ga,P as wa,k as ka,f as ya,g as ba,J as Pa,H as Oa}from"./naive-ui-eecf2ec3.js";import"./content-a642a616.js";import"./paopao-video-player-2fe58954.js";import"./copy-to-clipboard-4ef7d3eb.js";import"./@babel-725317a4.js";import"./toggle-selection-93f4ad84.js";import"./vooks-6d99783e.js";import"./evtd-b614532e.js";import"./axios-4a70c6fc.js";import"./moment-2ab8298d.js";/* empty css               */import"./seemly-76b7b838.js";import"./vueuc-7c8d4b48.js";import"./@css-render-7124a1a5.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-6a5c5852.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-8412e618.js";import"./treemate-25c27bff.js";import"./async-validator-dee29e8b.js";import"./date-fns-975a2d8f.js";const Fa={key:0,class:"profile-baseinfo"},Ta={class:"avatar"},Ia={class:"base-info"},xa={class:"username"},Aa={class:"userinfo"},$a={class:"info-item"},za={class:"info-item"},Ua={class:"userinfo"},qa={class:"info-item"},Ma={class:"info-item"},Ca={class:"info-item"},Sa={key:0,class:"user-opts"},Wa={key:0,class:"skeleton-wrap"},La={key:1},Ba={key:0,class:"empty-wrap"},Da={key:1},Ha={key:0},Na={key:1},Ra={key:2},Va={key:3},ja={key:4},Ea={key:2},Ga={key:0},Ja={key:1},Ka={key:2},Ya={key:3},Qa={key:4},Xa={class:"load-more-wrap"},Za={class:"load-more-spinner"},es=Ee({__name:"User",setup(as){const R=da(),v=Xe(),$=Ze(),f=i(!1),y=i(!1),a=Ge({id:0,avatar:"",username:"",nickname:"",is_admin:!1,is_friend:!0,is_following:!1,created_on:0,follows:0,followings:0,tweets_count:0,status:1}),h=i(!1),V=i(!1),G=i(!1),l=i([]),z=i([]),U=i([]),q=i([]),M=i([]),C=i([]),x=i($.query.s||""),n=i(+$.query.p||1),p=i("post"),J=i(+$.query.p||1),K=i(1),Y=i(1),Q=i(1),X=i(1),k=i(20),d=i(0),Z=i(0),ee=i(0),ae=i(0),se=i(0),te=i(0),b=e=>{a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.avatar=e.avatar,V.value=!0},P=e=>{R.success({title:"提示",content:"确定"+(e.user.is_following?"取消关注":"关注")+"该用户吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{e.user.is_following?fe({user_id:e.user.id}).then(_=>{window.$message.success("操作成功"),ce(e.user_id,!1)}).catch(_=>{}):pe({user_id:e.user.id}).then(_=>{window.$message.success("关注成功"),ce(e.user_id,!0)}).catch(_=>{})}})};function ce(e,_){S(z,e,_),S(U,e,_),S(q,e,_),S(M,e,_),S(C,e,_)}function S(e,_,ie){if(e.value&&e.value.length>0)for(let E in e.value)e.value[E].user_id==_&&(e.value[E].user.is_following=ie)}const we=()=>{y.value=!1,l.value=[],z.value=[],U.value=[],q.value=[],M.value=[],C.value=[],p.value="post",n.value=1,J.value=1,K.value=1,Y.value=1,Q.value=1,X.value=1,d.value=0,Z.value=0,ee.value=0,ae.value=0,se.value=0,te.value=0},ke=()=>{switch(p.value){case"post":j();break;case"comment":le();break;case"highlight":ne();break;case"media":oe();break;case"star":ue();break}},j=()=>{f.value=!0,N({username:x.value,style:"post",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),z.value=l.value,Z.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},le=()=>{f.value=!0,N({username:x.value,style:"comment",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),U.value=l.value,ee.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},ne=()=>{f.value=!0,N({username:x.value,style:"highlight",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),q.value=l.value,ae.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},oe=()=>{f.value=!0,N({username:x.value,style:"media",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),M.value=l.value,se.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},ue=()=>{f.value=!0,N({username:x.value,style:"star",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),C.value=l.value,te.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},ye=e=>{switch(p.value=e,p.value){case"post":l.value=z.value,n.value=J.value,d.value=Z.value,j();break;case"comment":l.value=U.value,n.value=K.value,d.value=ee.value,le();break;case"highlight":l.value=q.value,n.value=Y.value,d.value=ae.value,ne();break;case"media":l.value=M.value,n.value=Q.value,d.value=se.value,oe();break;case"star":l.value=C.value,n.value=X.value,d.value=te.value,ue();break}},W=()=>{h.value=!0,ea({username:x.value}).then(e=>{h.value=!1,a.id=e.id,a.avatar=e.avatar,a.username=e.username,a.nickname=e.nickname,a.is_admin=e.is_admin,a.is_friend=e.is_friend,a.created_on=e.created_on,a.is_following=e.is_following,a.follows=e.follows,a.followings=e.followings,a.status=e.status,e.tweets_count&&(a.tweets_count=e.tweets_count),ke()}).catch(e=>{h.value=!1,console.log(e)})},be=()=>{switch(p.value){case"post":J.value=n.value,j();break;case"comment":K.value=n.value,le();break;case"highlight":Y.value=n.value,ne();break;case"media":Q.value=n.value,oe();break;case"star":X.value=n.value,ue();break}},Pe=()=>{V.value=!0},Oe=()=>{G.value=!0},Fe=()=>{V.value=!1},Te=()=>{G.value=!1},A=e=>()=>me(ge,null,{default:()=>me(e)}),Ie=Je(()=>{let e=[{label:"私信",key:"whisper",icon:A(ia)}];return v.state.userInfo.is_admin&&(a.status===1?e.push({label:"禁言",key:"banned",icon:A(he)}):e.push({label:"解封",key:"deblocking",icon:A(he)})),a.is_following?e.push({label:"取消关注",key:"unfollow",icon:A(ra)}):e.push({label:"关注",key:"follow",icon:A(ca)}),v.state.profile.useFriendship&&(a.is_friend?e.push({label:"删除好友",key:"delete",icon:A(va)}):e.push({label:"添加朋友",key:"requesting",icon:A(_a)})),e}),xe=e=>{switch(e){case"whisper":Pe();break;case"delete":Ae();break;case"requesting":Oe();break;case"follow":case"unfollow":$e();break;case"banned":case"deblocking":ze();break}},Ae=()=>{R.warning({title:"删除好友",content:"将好友 “"+a.nickname+"” 删除，将同时删除 点赞/收藏 列表中关于该朋友的 “好友可见” 推文",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{h.value=!0,sa({user_id:a.id}).then(e=>{h.value=!1,a.is_friend=!1,j()}).catch(e=>{h.value=!1,console.log(e)})}})},$e=()=>{R.success({title:"提示",content:"确定"+(a.is_following?"取消关注":"关注")+"该用户吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{h.value=!0,a.is_following?fe({user_id:a.id}).then(e=>{h.value=!1,window.$message.success("取消关注成功"),W()}).catch(e=>{h.value=!1,console.log(e)}):pe({user_id:a.id}).then(e=>{h.value=!1,window.$message.success("关注成功"),W()}).catch(e=>{h.value=!1,console.log(e)})}})},ze=()=>{R.warning({title:"警告",content:"确定对该用户进行"+(a.status===1?"禁言":"解封")+"处理吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{h.value=!0,ta({id:a.id,status:a.status===1?2:1}).then(e=>{h.value=!1,a.status===1?window.$message.success("禁言成功"):window.$message.success("解封成功"),W()}).catch(e=>{h.value=!1,console.log(e)})}})},Ue=()=>{n.value<d.value||d.value==0?(y.value=!1,n.value++,be()):y.value=!0};return Ke(()=>{W()}),Ye(()=>({path:$.path,query:$.query}),(e,_)=>{_.path==="/u"&&e.path==="/u"&&(x.value=$.query.s||"",we(),W())}),(e,_)=>{const ie=je,E=pa,re=ha,ve=Qe("router-link"),qe=ga,Me=wa,Ce=Ve,_e=ka,L=ya,Se=ba,We=Re,Le=Pa,B=He,O=Oa,D=Ne,Be=ma,De=fa;return s(),u("div",null,[o(ie,{title:"用户详情"}),o(Be,{class:"main-content-wrap profile-wrap",bordered:""},{default:r(()=>[o(_e,{show:h.value},{default:r(()=>[a.id>0?(s(),u("div",Fa,[w("div",Ta,[o(E,{size:72,src:a.avatar},null,8,["src"])]),w("div",Ia,[w("div",xa,[w("strong",null,I(a.nickname),1),w("span",null," @"+I(a.username),1),c(v).state.profile.useFriendship&&c(v).state.userInfo.id>0&&c(v).state.userInfo.username!=a.username&&a.is_friend?(s(),g(re,{key:0,class:"top-tag",type:"info",size:"small",round:""},{default:r(()=>[H(" 好友 ")]),_:1})):m("",!0),c(v).state.userInfo.id>0&&c(v).state.userInfo.username!=a.username&&a.is_following?(s(),g(re,{key:1,class:"top-tag",type:"success",size:"small",round:""},{default:r(()=>[H(" 已关注 ")]),_:1})):m("",!0),a.is_admin?(s(),g(re,{key:2,class:"top-tag",type:"error",size:"small",round:""},{default:r(()=>[H(" 管理员 ")]),_:1})):m("",!0)]),w("div",Aa,[w("span",$a,"UID. "+I(a.id),1),w("span",za,I(c(aa)(a.created_on))+" 加入",1)]),w("div",Ua,[w("span",qa,[o(ve,{onClick:_[0]||(_[0]=de(()=>{},["stop"])),class:"following-link",to:{name:"following",query:{s:a.username,n:a.nickname,t:"follows"}}},{default:r(()=>[H(" 关注  "+I(a.follows),1)]),_:1},8,["to"])]),w("span",Ma,[o(ve,{onClick:_[1]||(_[1]=de(()=>{},["stop"])),class:"following-link",to:{name:"following",query:{s:a.username,n:a.nickname,t:"followings"}}},{default:r(()=>[H(" 粉丝  "+I(a.followings),1)]),_:1},8,["to"])]),w("span",Ca," 泡泡  "+I(a.tweets_count),1)])]),c(v).state.userInfo.id>0&&c(v).state.userInfo.username!=a.username?(s(),u("div",Sa,[o(Me,{placement:"bottom-end",trigger:"click",size:"small",options:Ie.value,onSelect:xe},{default:r(()=>[o(qe,{quaternary:"",circle:""},{icon:r(()=>[o(c(ge),null,{default:r(()=>[o(c(ua))]),_:1})]),_:1})]),_:1},8,["options"])])):m("",!0)])):m("",!0),o(Ce,{show:V.value,user:a,onSuccess:Fe},null,8,["show","user"]),o(na,{show:G.value,user:a,onSuccess:Te},null,8,["show","user"])]),_:1},8,["show"]),o(Se,{class:"profile-tabs-wrap",type:"line",animated:"",value:p.value,"onUpdate:value":ye},{default:r(()=>[o(L,{name:"post",tab:"泡泡"}),o(L,{name:"comment",tab:"评论"}),o(L,{name:"highlight",tab:"亮点"}),o(L,{name:"media",tab:"图文"}),o(L,{name:"star",tab:"喜欢"})]),_:1},8,["value"]),f.value&&l.value.length===0?(s(),u("div",Wa,[o(We,{num:k.value},null,8,["num"])])):(s(),u("div",La,[l.value.length===0?(s(),u("div",Ba,[o(Le,{size:"large",description:"暂无数据"})])):m("",!0),c(v).state.desktopModelShow?(s(),u("div",Da,[p.value==="post"?(s(),u("div",Ha,[(s(!0),u(F,null,T(z.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(B,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="comment"?(s(),u("div",Na,[(s(!0),u(F,null,T(U.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(B,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="highlight"?(s(),u("div",Ra,[(s(!0),u(F,null,T(q.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(B,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="media"?(s(),u("div",Va,[(s(!0),u(F,null,T(M.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(B,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="star"?(s(),u("div",ja,[(s(!0),u(F,null,T(C.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(B,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0)])):(s(),u("div",Ea,[p.value==="post"?(s(),u("div",Ga,[(s(!0),u(F,null,T(z.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(D,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="comment"?(s(),u("div",Ja,[(s(!0),u(F,null,T(U.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(D,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="highlight"?(s(),u("div",Ka,[(s(!0),u(F,null,T(q.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(D,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="media"?(s(),u("div",Ya,[(s(!0),u(F,null,T(M.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(D,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),p.value==="star"?(s(),u("div",Qa,[(s(!0),u(F,null,T(C.value,t=>(s(),g(O,{key:t.id},{default:r(()=>[o(D,{post:t,isOwner:c(v).state.userInfo.id==t.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:P},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0)]))]))]),_:1}),d.value>0?(s(),g(De,{key:0,justify:"center"},{default:r(()=>[o(c(oa),{class:"load-more",slots:{complete:"没有更多泡泡了",error:"加载出错"},onInfinite:_[2]||(_[2]=t=>Ue())},{spinner:r(()=>[w("div",Xa,[y.value?m("",!0):(s(),g(_e,{key:0,size:14})),w("span",Za,I(y.value?"没有更多泡泡了":"加载更多"),1)])]),_:1})]),_:1})):m("",!0)])}}});const Cs=la(es,[["__scopeId","data-v-85a170e0"]]);export{Cs as default};
